<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Camera and Photo Gallery APIs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Scroll EclipseHelp Exporter" name="generator" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" media="print" />
</head>
<body>
<div class="container">
<div class="header"></div>
<div id="29004913" class="content"><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=29004913"><span>Edit</span></a>
<h1>Camera and Photo Gallery APIs</h1>
<div class="section section-2 " id="29004913_CameraandPhotoGalleryAPIs-Objective">
<h2 class="heading "><span>Objective</span></h2>
<p>
In this chapter, you'll learn how to capture an image from the camera, use it in an app, and save it to the gallery or filesystem. You'll also explore the closely related gallery APIs, which let your users grab images from their photo albums for use within your app.    </p>
</div>
<div class="section section-2 " id="29004913_CameraandPhotoGalleryAPIs-Contents">
<h2 class="heading "><span>Contents</span></h2>
<p>
The APIs that you use to access the camera and photo gallery are very similar. Both use the same function signature, though the actual method names vary. We'll start with a look at the camera API then see how you apply the same techniques to the gallery.    </p>
<div class="section section-3 " id="29004913_CameraandPhotoGalleryAPIs-Camera">
<h3 class="heading "><span>Camera</span></h3>
<p>
You can access both the rear-facing and front-facing cameras in devices that have them. You can capture still images and video from the camera. Then you can use the resulting images in your app, save them to the file system, upload them, or save them to the gallery. You open the camera by calling the <a class="external-link external-link" href="#!/api/Titanium.Media-method-showCamera"><tt class=" ">showCamera()</tt></a> method. When doing so, you define three callback functions that are called for the success, cancel, and error events, as shown here:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// This example is only able to capture video on the iOS platform.</code></div>
<div class="line"><code class="comments">// To capture video on the Android platform, see the Android Capture Video Example below.</code></div>
<div class="line"><code class="comments">// For BlackBerry, you need to add the `use_camera` and `access_shared` permission in your project's tiapp.xml file.</code></div>
<div class="line"><code class="plain">Titanium.Media.showCamera({</code></div>
<div class="line"><code class="plain">	success:function(event) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// called when media returned from the camera</code></div>
<div class="line"><code class="plain">		Ti.API.debug(</code><code class="string">'Our type was: '</code><code class="plain">+event.mediaType);</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain">(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {</code></div>
<div class="line"><code class="plain">			var imageView = Ti.UI.createImageView({</code></div>
<div class="line"><code class="plain">				width:win.width,</code></div>
<div class="line"><code class="plain">				height:win.height,</code></div>
<div class="line"><code class="plain">				image:event.media</code></div>
<div class="line"><code class="plain">			});</code></div>
<div class="line"><code class="plain">			win.add(imageView);</code></div>
<div class="line"><code class="plain">		} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">			alert(</code><code class="string">"got the wrong type back ="</code><code class="plain">+event.mediaType);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	},</code></div>
<div class="line"><code class="plain">	cancel:function() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// called when user cancels taking a picture</code></div>
<div class="line"><code class="plain">	},</code></div>
<div class="line"><code class="plain">	error:function(error) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// called when there's an error</code></div>
<div class="line"><code class="plain">		var a = Titanium.UI.createAlertDialog({title:</code><code class="string">'Camera'</code><code class="plain">});</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (error.code == Titanium.Media.NO_CAMERA) {</code></div>
<div class="line"><code class="plain">			a.setMessage(</code><code class="string">'Please run this test on device'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">		} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">			a.setMessage(</code><code class="string">'Unexpected error: '</code><code class="plain"> + error.code);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">		a.show();</code></div>
<div class="line"><code class="plain">	},</code></div>
<div class="line"><code class="plain">	saveToPhotoGallery:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// allowEditing and mediaTypes are iOS-only settings</code></div>
<div class="line"><code class="plain">	allowEditing:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	mediaTypes:[Ti.Media.MEDIA_TYPE_VIDEO,Ti.Media.MEDIA_TYPE_PHOTO]</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div> <p>
The <tt class=" ">saveToPhotoGallery</tt> property controls whether the photo or video is automatically saved to the device's photo gallery. Using <tt class=" ">Ti.Filesystem</tt> you could save to the filesystem in addition to or in place of saving to the gallery. Because the user can delete items from the gallery separately from your app, you should save media to the filesystem if your app will depend on its availability later.    </p>
<p>
Some other useful properties include:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">autohide</tt> (boolean) if the camera should auto hide after the media capture is completed (defaults to true) (iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">animated</tt> (boolean) if the dialog should be animated (defaults to true) upon showing and hiding (Android and iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">allowEditing</tt> (boolean) if the media should be editable after capture in the UI interface (iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">mediaTypes</tt> an array of media type constants supported by the capture device UI (iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">videoMaximumDuration</tt> (float) duration on how long in milliseconds to allow capture before completing (iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">videoQuality</tt> (Ti.Media constant) to indicate the video quality during capture (iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">showControls</tt> (boolean) to indicate if the built-in UI controls should be displayed (iOS only)    </p>
</li><li class=" "> <p>
<tt class=" ">overlay</tt> (Ti.UI.View) which is added as an overlay to the camera UI (on top)    </p>
</li><li class=" "> <p>
<tt class=" ">transform</tt> a transformation matrix that applies to the camera UI (not to the media returned) (iOS only)    </p>
</li></ul> <p>
You can check for the availability of the camera with the <tt class=" ">Titanium.Media.isCameraSupported</tt> property: it's false if the device has no camera. The simulator/emulator does not have camera support. Other devices without cameras include 3rd generation and older iPods, the Nook Color, and Kindle Fire.    </p>
<div class="section section-4 " id="29004913_CameraandPhotoGalleryAPIs-BlackBerryPlatformNote">
<h4 class="heading "><span>BlackBerry Platform Note</span></h4>
<p>
On the BlackBerry platform, in your project's <tt class=" ">tiapp.xml</tt> file, add the <tt class=" ">use_camera</tt> permission to use the device's camera and the <tt class=" ">access_shared</tt> permission to access the device's shared storage for pictures and other files.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">tiapp.xml</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">&lt;?xml version=</code><code class="string">"1.0"</code><code class="plain"> encoding=</code><code class="string">"UTF-8"</code><code class="plain">?&gt;</code></div>
<div class="line"><code class="plain">&lt;ti:app xmlns:ti=</code><code class="string">"http://ti.appcelerator.org"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;blackberry&gt;</code></div>
<div class="line"><code class="plain">        &lt;permissions&gt;</code></div>
<div class="line"><code class="plain">            &lt;permission&gt;access_shared&lt;/permission&gt;</code></div>
<div class="line"><code class="plain">            &lt;permission&gt;use_camera&lt;/permission&gt;</code></div>
<div class="line"><code class="plain">        &lt;/permissions&gt;</code></div>
<div class="line"><code class="plain">    &lt;/blackberry&gt;</code></div>
<div class="line"><code class="plain">&lt;ti:app&gt;</code></div>
</div>
</div> </div>
<div class="section section-4 " id="29004913_CameraandPhotoGalleryAPIs-Front/rearcamerasupport">
<h4 class="heading "><span>Front/rear camera support</span></h4>
<p>
You can access both the front and rear facing cameras, if a device has such cameras. The code snippet below shows one way you might do this. Key properties are the <tt class=" ">Ti.Media.CAMERA_REAR</tt> and <tt class=" ">Ti.Media.CAMERA_FRONT</tt> as well as the <tt class=" ">Ti.Media.switchCamera()</tt> method.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var cameras = Ti.Media.availableCameras;</code></div>
<div class="line"><code class="keyword">for</code><code class="plain"> (var c=</code><code class="value">0</code><code class="plain">; c &lt; cameras.length; c++) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// if we have a rear camera ... we add switch button</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (cameras[c]==Ti.Media.CAMERA_REAR) {</code></div>
<div class="line"><code class="plain">		overlay.add(cameraType);</code></div>
<div class="line"><code class="plain">		cameraType.addEventListener(</code><code class="string">'click'</code><code class="plain">,function() {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (Ti.Media.camera == Ti.Media.CAMERA_FRONT) {</code></div>
<div class="line"><code class="plain">				cameraType.title = </code><code class="string">"front"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">				Ti.Media.switchCamera(Ti.Media.CAMERA_REAR);</code></div>
<div class="line"><code class="plain">			} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">				cameraType.title = </code><code class="string">"rear"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">				Ti.Media.switchCamera(Ti.Media.CAMERA_FRONT);</code></div>
<div class="line"><code class="plain">			}</code></div>
<div class="line"><code class="plain">		});</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">break</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> </div>
<div class="section section-4 " id="29004913_CameraandPhotoGalleryAPIs-AndroidCaptureVideoExample">
<h4 class="heading "><span>Android Capture Video Example</span></h4>
<p>
The Titanium SDK does not expose a way to capture video on the Android platform using the <tt class=" ">Titanium.Media API</tt>.  Instead, you need to use an Android intent to start a new activity that captures video.    </p>
<p>
The following example creates an Android intent to capture video.  This intent is used to start a new activity, which launches the camera to record video.  After the user stops recording, the video is saved to the device's gallery.  The callback retrieves the URI of the video media and stores the reference in a global variable.  Using the global variable, you can launch the video in a media player or save the content to a different location.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// App UI</code></div>
<div class="line"><code class="plain">var win = Titanium.UI.createWindow({ </code></div>
<div class="line"><code class="plain">    backgroundColor: </code><code class="string">'#fff'</code><code class="plain">, layout: </code><code class="string">'vertical'</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">var recordButton = Titanium.UI.createButton({</code></div>
<div class="line"><code class="plain">    title: </code><code class="string">'Record Video'</code><code class="plain">, top: </code><code class="string">'10dp'</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(recordButton);</code></div>
<div class="line"><code class="plain">var playButton = Titanium.UI.createButton({</code></div>
<div class="line"><code class="plain">    title: </code><code class="string">'Play Recorded Video'</code><code class="plain">, visible: </code><code class="keyword">false</code><code class="plain">, top: </code><code class="string">'10dp'</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(playButton);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
<div class="line"><code class="comments">// Holds a reference to the media URI</code></div>
<div class="line"><code class="plain">var videoURL = </code><code class="keyword">null</code><code class="plain">;</code></div>
<div class="line"><code class="plain">recordButton.addEventListener(</code><code class="string">'click'</code><code class="plain">, function() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Start an activity with an intent to capture video</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// http://developer.android.com/reference/android/provider/MediaStore.html#ACTION_VIDEO_CAPTURE</code></div>
<div class="line"><code class="plain">    var intent = Titanium.Android.createIntent({ action: </code><code class="string">'android.media.action.VIDEO_CAPTURE'</code><code class="plain"> });</code></div>
<div class="line"><code class="plain">    win.activity.startActivityForResult(intent, function(e) {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.resultCode == Ti.Android.RESULT_OK) {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.intent.data != </code><code class="keyword">null</code><code class="plain">) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// If everything went OK, save a reference to the video URI</code></div>
<div class="line"><code class="plain">                videoURL = e.intent.data;</code></div>
<div class="line"><code class="plain">                playButton.visible = </code><code class="keyword">true</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    	    }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">                Ti.API.error(</code><code class="string">'Could not retrieve media URL!'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.resultCode == Ti.Android.RESULT_CANCELED) {</code></div>
<div class="line"><code class="plain">            Ti.API.trace(</code><code class="string">'User cancelled video capture session.'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            Ti.API.error(</code><code class="string">'Could not record video!'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    });</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">playButton.addEventListener(</code><code class="string">'click'</code><code class="plain">, function(){</code></div>
<div class="line"><code class="plain">    var player = Ti.Media.createVideoPlayer({ url: videoURL, autoplay: </code><code class="keyword">true</code><code class="plain">});</code></div>
<div class="line"><code class="plain">    win.add(player);</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div> <p>
</p>
</div>
</div>
<div class="section section-3 " id="29004913_CameraandPhotoGalleryAPIs-Gallery">
<h3 class="heading "><span>Gallery</span></h3>
<p>
You open the native gallery by calling the <a class="external-link external-link" href="#!/api/Titanium.Media-method-openPhotoGallery"><tt class=" ">openPhotoGallery()</tt></a> method. As with the camera, you define three callback functions that are called for the success, cancel, and error events. The camera and gallery methods are so similar that I won't repeat the code block here. Just replace <tt class=" ">showCamera()</tt> with <tt class=" ">openPhotoGallery()</tt> in the code block above and you'll be good to go.    </p>
<p>
Some other useful properties include:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">animated</tt> (boolean) if the dialog should be animated (defaults to true) upon showing and hiding    </p>
</li><li class=" "> <p>
<tt class=" ">allowEditing</tt> (boolean) if the media should be editable after capture in the UI interface    </p>
</li><li class=" "> <p>
<tt class=" ">saveToPhotoGallery</tt> (boolean) whether modified media should be saved back to the gallery, generally only useful with <tt class=" ">allowEditing=true</tt> </p>
</li><li class=" "> <p>
<tt class=" ">mediaTypes</tt> an array of media type constants supported by the capture device UI    </p>
</li><li class=" "> <p>
<tt class=" ">showControls</tt> (boolean) to indicate if the built-in UI controls should be displayed    </p>
</li><li class=" "> <p>
<tt class=" ">overlay</tt> (Ti.UI.View) which is added as an overlay to the camera UI (on top)    </p>
</li><li class=" "> <p>
<tt class=" ">transform</tt> a transformation matrix that applies to the camera UI (not to the media returned)    </p>
</li><li class=" "> <p>
(iPad only) <tt class=" ">popoverView</tt> (Ti.UI.View) to position the photo gallery popover a specific view    </p>
</li><li class=" "> <p>
(iPad only) <tt class=" ">arrowDirection</tt> control the type of arrow and position of the gallery    </p>
</li></ul> <div class="section section-4 " id="29004913_CameraandPhotoGalleryAPIs-Gettingimagesintothesimulator/emulator'sgallery">
<h4 class="heading "><span>Getting images into the simulator/emulator's gallery</span></h4>
<p>
The photo gallery on the simulator/emulator is of course empty to start. If you'll be testing photo gallery code, you'll need to put some images there. You can do so by following this procedure:    </p>
<ol class=" "><li class=" "> <p>
Open the gallery in the simulator/emulator, then close it. You have to do this at least once to initialize its data storage structures.    </p>
</li><li class=" "> <p>
Find an image to save. For example, open the web browser, search for, and display an image.    </p>
</li><li class=" "> <p>
Long-press on the image, when you release, you should get a menu of options.    </p>
</li><li class=" "> <p>
Tap Save Image (or your device's equivalent button) to save the image to the gallery.    </p>
</li></ol> </div>
</div>
<div class="section section-3 " id="29004913_CameraandPhotoGalleryAPIs-Hands-onPractice">
<h3 class="heading "><span>Hands-on Practice</span></h3>
<div class="section section-4 " id="29004913_CameraandPhotoGalleryAPIs-Goal">
<h4 class="heading "><span>Goal</span></h4>
<p>
In this activity, you will write an app that will capture an image from the camera and display it in a view. If the device doesn't have a camera, your app should display the gallery picker instead.    </p>
</div>
<div class="section section-4 " id="29004913_CameraandPhotoGalleryAPIs-Steps">
<h4 class="heading "><span>Steps</span></h4>
<ol class=" "><li class=" "> <p>
Create a new project named PhotoTest.    </p>
</li><li class=" "> <p>
On tab1 of the default project, replace the label with an ImageView that is 300x300 points positioned 5 points from the top.    </p>
</li><li class=" "> <p>
Add a button that is 100x50 positioned 5 points from the bottom.    </p>
</li><li class=" "> <p>
When the button is clicked, show the camera if it's available, otherwise open the photo gallery. You'll need three callbacks--write your code to reuse the same three functions to minimize duplicated code. You'll need these callbacks:    </p>
<ul class=" "><li class=" "> <p>
Success: set the ImageView's image property to the media returned from the camera or gallery. Output the <tt class=" ">mediaType</tt> to the info console.    </p>
</li><li class=" "> <p>
Cancel: don't do anything in this function    </p>
</li><li class=" "> <p>
Error: Display an alert dialog box showing the <tt class=" ">error.code</tt> describing why the operation failed.    </p>
</li></ul></li><li class=" "> <p>
Open the simulator/emulator and save at least one photo to it, following the steps above.    </p>
</li><li class=" "> <p>
Build the app and run it on the simulator/emulator. The gallery should open.    </p>
</li><li class=" "> <p>
(Optional) Install the app onto a device and run it from there. The camera should open.    </p>
</li></ol> </div>
</div>
</div>
<div class="section section-2 " id="29004913_CameraandPhotoGalleryAPIs-Summary">
<h2 class="heading "><span>Summary</span></h2>
<p>
In this chapter, you learned how to capture an image from the camera, use it in an app, and save it to the gallery or filesystem. You also explored the closely related gallery APIs, which let your users grab images from their photo albums for use within your app.    </p>
</div>
</div>
<div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence" target="_blank">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
</div>
</body>
</html>
