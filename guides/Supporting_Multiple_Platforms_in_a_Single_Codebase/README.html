<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Supporting Multiple Platforms in a Single Codebase</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Scroll EclipseHelp Exporter" name="generator" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" media="print" />
</head>
<body>
<div class="container">
<div class="header"></div>
<div id="29004890" class="content"><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=29004890"><span>Edit</span></a>
<h1>Supporting Multiple Platforms in a Single Codebase</h1>
<div class="section section-2 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Objective">
<h2 class="heading "><span>Objective</span></h2>
<p>
In this section, you will explore the ways you can support both Android and iOS within a single Titanium project. Through a combination of platform specific feature abstraction and usage of conditional code branching, Titanium provides you with a powerful mechanism for creating cross platform, native mobile apps with a maximum amount of code reuse.    </p>
</div>
<div class="section section-2 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Contents">
<h2 class="heading "><span>Contents</span></h2>
<p>
Titanium is not a write once, run anywhere framework. It's more aptly referred to as a &quot;<i class=" ">write once, adapt everywhere&quot;</i> framework. Your business logic, networking, database, and event handling logic will be close to 100% cross-platform compatible. The user interfaces on iOS and Android differ so significantly that in most cases you'll have to do at least a little platform specific coding. That said, it's not uncommon for cross platform apps to reuse 80, 90, or even 100% of their UI code as well.    </p>
<div class="section section-3 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Embracetheplatform">
<h3 class="heading "><span>Embrace the platform</span></h3>
<p>
Best of breed, native apps take full advantage of the platforms on which they run. Your Titanium apps should do more than just run on iOS and Android. When running on an iOS device, your app should feel like an iOS app. Your Android app should feel like an Android app. By this, we mean apps that:    </p>
<ul class=" "><li class=" "> <p>
Follow platform UI conventions, such as tabs at the top (Android) or bottom (iOS).    </p>
</li><li class=" "> <p>
Use hardware-specific features, such as the Android Menu button.    </p>
</li><li class=" "> <p>
Use OS-specific controls, such left and right navigation buttons in title bars on iOS.    </p>
</li><li class=" "> <p>
Participate in the platform ecosystem, such as using platform-appropriate notification mechanisms.    </p>
</li></ul> <p>
The best approach when creating cross-platform apps is to develop and test for both iOS and Android right from the start. Designing and developing your app with multiple platforms in mind right away will be significantly more efficient than developing for one, then porting to the next.    </p>
</div>
<div class="section section-3 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Cross-platformmechanics">
<h3 class="heading "><span>Cross-platform mechanics</span></h3>
<p>
Before we get into the strategies you should adopt, let's look at the mechanics of handling cross-platform coding within Titanium. This includes:    </p>
<ul class=" "><li class=" "> <p>
Platform identification    </p>
</li><li class=" "> <p>
Recognizing platform-specific APIs and properties    </p>
</li><li class=" "> <p>
Handling platform-specific resources    </p>
</li></ul> <div class="section section-4 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Platformidentification">
<h4 class="heading "><span>Platform identification</span></h4>
<p>
Titanium provides platform-identification properties in the <tt class=" ">Ti.Platform</tt> namespace that you can use for conditional branching within your code. These are:    </p>
<div class="tablewrap">
<table class="confluenceTable">
<thead class=" "></thead><tfoot class=" "></tfoot><tbody class=" "> <tr>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<strong class=" ">Property</strong> </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<strong class=" ">Description</strong> </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<strong class=" ">Sample values</strong> </p>
</td>
</tr>
<tr>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<tt class=" ">Ti.Platform.name</tt> </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
Returns the name of the platform returned by the device    </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<tt class=" ">iPhone OS</tt> for iPhone or iPod, <tt class=" ">android</tt> for Android, returns the <tt class=" ">navigator.userAgent</tt> string on Mobile Web    </p>
</td>
</tr>
<tr>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<tt class=" ">Ti.Platform.osname</tt> </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
Returns an abbreviated identifier of the platform    </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<tt class=" ">iphone</tt> for iPhone or iPod, <tt class=" ">ipad</tt> for iPad, <tt class=" ">android</tt> for Android, and <tt class=" ">mobileweb</tt> on Mobile Web    </p>
</td>
</tr>
<tr>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<tt class=" ">Ti.Platform.model</tt> </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
Returns device model identifier    </p>
</td>
<td class="confluenceTd" rowspan="1" colspan="1">
<p>
<tt class=" ">iPhone 3GS</tt> or <tt class=" ">iPod Touch 2G</tt> or <tt class=" ">Droid</tt> (unsupported on Mobile Web)    </p>
</td>
</tr>
</tbody> </table>
</div>
</div>
<div class="section section-4 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Platform-specificAPIsandproperties">
<h4 class="heading "><span>Platform-specific APIs and properties</span></h4>
<p>
Many of the Titanium APIs are separated according to the platform on which they are supported. For example, the Ti.UI.iPhone namespace includes user interface components that are supported on only on the iOS operating system. The same is true of the Ti.UI.iOS, Ti.UI.iPad, and Ti.UI.Android namespaces. By segmenting such platform-specific functionality, we help make it clear what will and won't work on the various platforms.    </p>
<p>
As you explore the API docs, you will find also many platform-specific properties and values. For example, the Ti.UI.Window object has an Android-specific property called <tt class=" ">softInputMode</tt>. That property's value must be one of the constants in the Ti.UI.Android namespace. These platform-specific properties are labeled as such. To avoid crashing and errors, don't try to use them on other platforms.    </p>
<p>
Another concern is platform-specific constants. Explore the API docs and you'll see lots of constants that define button appearance, media file type, and so forth. When these are platform specific, they are generally put into their own sub-namespace. (If they're not in a platform-specific namespace, expect that we'll be moving them there as we clear up platform parity issues.) For example, Titanium.UI.iOS.ANIMATION_CURVE_EASE_IN defines an iOS-specific animation property. Don't use one platform's constants on another platform or your code will throw an error.    </p>
</div>
<div class="section section-4 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Platform-specificresources">
<h4 class="heading "><span>Platform-specific resources</span></h4>
<p>
Titanium gives you various ways to include platform-specific resources, like images, stylesheets, and scripts, in your project. Titanium uses an &quot;overrides&quot; system to make it easy to use platform-specific resources. Any file in the platform-specific Resources directories (<tt class=" ">Resources/android</tt>, <tt class=" ">Resources/blackberry</tt>, <tt class=" ">Resources/iphone</tt>, or <tt class=" ">Resources/mobileweb</tt>) will override, or be used in place of, those in the <tt class=" ">Resources</tt> directory. You don't have to use any special notation in your code to specify that these files should be used.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var img = Ti.UI.createImageView({</code></div>
<div class="line"><code class="plain">	image: </code><code class="string">'logo.png'</code></div>
<div class="line"><code class="plain"> </code><code class="comments">/* Resources/android/logo.png or Resources/iphone/logo.png  or </code></div>
<div class="line"><code class="comments">	*  Resources/mobileweb/logo.png will be used automatically if they exist</code></div>
<div class="line"><code class="comments">	*  when you build for those platforms, respectively</code></div>
<div class="line"><code class="comments">	*/</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div> <p>
You can maintain a hierarchy of folders within the Resources or platform-specific folder. For example, let's say you put most of your images into the <tt class=" ">Resources/images</tt> folder. To include platform-specific overrides, you would duplicate that folder hierarchy in the platform folders. Thus, you'd need to put the images into the <tt class=" ">Resources/android/images</tt>, <tt class=" ">Resources/blackberry/images</tt>, <tt class=" ">Resources/iphone/images</tt>, and <tt class=" ">Resources/mobileweb/images</tt> folders.    </p>
<p>
Here's an example that shows this feature in action with a CommonJS require() module. The code simply calls the base name of the file. Titanium grabs the platform-specific version at build time, which you can see in the Android emulator, iPhone simulator, and Chrome running the Mobile Web preview.    </p>
<p>
<img src="images/download/attachments/29004890/crossplatform.png" alt="images/download/attachments/29004890/crossplatform.png" class="confluence-embedded-image" width="800" />
</p>
<div class="section section-5 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Platform-specificJSS">
<h5 class="heading "><span>Platform-specific JSS</span></h5>
<p>
</p>
<div class="confbox admonition admonition-warning aui-message problem shadowed information-macro">
<p>
As of Release 3.2.0, JavaScript Style Sheets (JSS) are deprecated and no longer supported.    </p>
</div>
<p>
JavaScript Style Sheets (JSS) are a means to separate presentation and code. You supply an external stylesheet (which uses a syntax closely matching CSS) giving the file a name that matches the associated JS file. So, the stylesheet for the <tt class=" ">ui.js</tt> file is named <tt class=" ">ui.jss</tt>. Add a <tt class=" ">class</tt> or <tt class=" ">id</tt> property when defining your UI components. Then, refer to them within the JSS file like you would in a CSS file.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">ui.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var appceleratorLabel = Ti.UI.createLabel({</code></div>
<div class="line"><code class="plain">	text:</code><code class="string">'Appcelerator'</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	id:</code><code class="string">'appceleratorLabel'</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div><div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">ui.jss</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">#appceleratorLabel {</code></div>
<div class="line"><code class="plain">	width:</code><code class="value">149</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	text-align:</code><code class="string">'center'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	color:</code><code class="string">'#999'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	font-size:</code><code class="string">'13'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
That was a lot of explanation to get to the point of this section. Titanium supports platform-specific JSS files as well. You can have ui.android.jss and ui.iphone.jss files and Titanium will make sure the correct one is applied when you build your app. (Make sure you don't have a ui.jss file, or it will be used rather than the platform-specific versions.)    </p>
</div>
</div>
</div>
<div class="section section-3 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Strategiesandrecommendations">
<h3 class="heading "><span>Strategies and recommendations</span></h3>
<div class="section section-4 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Branching">
<h4 class="heading "><span>Branching</span></h4>
<p>
Branching in code is useful when your code will be <i class=" ">mostly the same</i> across platforms, but vary here and there. Long blocks of if...then code are difficult to read and maintain. Also, excessive branching will slow your app's execution. If you must use this technique, try to group as much code as you can within a branch and defer loading as much as possible to mitigate the performance penalty of branching.    </p>
<p>
It's best practice to query the platform value once, then store it in a globally accessible variable. Each time you request one of those properties, Titanium has to query the operating system for the value. This &quot;trip across the bridge&quot; takes a few cycles and if used too frequently could possibly slow your program. Something like the following would be more efficient:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// create a JavaScript alias to the platform-specific property</code></div>
<div class="line"><code class="plain">var osname = Ti.Platform.osname;</code></div>
<div class="line"><code class="comments">// Booleans identifying the platforms are handy too</code></div>
<div class="line"><code class="plain">var isAndroid = (osname==</code><code class="string">'android'</code><code class="plain">) ? </code><code class="keyword">true</code><code class="plain"> : </code><code class="keyword">false</code><code class="plain">;</code></div>
<div class="line"><code class="keyword">if</code><code class="plain">(isAndroid) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// do Android specific stuff</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// do iOS, mobileweb, or other platform stuff</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
You can use JavaScript's <a class="external-link external-link" href="http://en.wikipedia.org/wiki/Ternary_operation#C.2C_Java.2C_JavaScript" target="_blank">ternary operator</a> when you need to branch on a specific property, like this:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var isAndroid = (Ti.Platform.osname=='android) ? </code><code class="keyword">true</code><code class="plain"> : </code><code class="keyword">false</code><code class="plain">;</code></div>
<div class="line"><code class="plain">var win = Ti.UI.createWindow({</code></div>
<div class="line"><code class="plain">	softInputMode: (isAndroid) ? Ti.UI.Android.SOFT_INPUT_ADJUST_PAN : </code><code class="keyword">null</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div> <p>
Keep in mind the growing list of supported platforms and don't fall prey to coding in an if/else relationship that won't support new platforms. For example, don't do the following:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">Anti-pattern!</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var osname = Ti.Platform.osname;</code></div>
<div class="line"><code class="keyword">if</code><code class="plain">(osname != </code><code class="string">'android'</code><code class="plain">) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// don't assume this means iOS! It could be mobile web or some future-supported platform.</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> </div>
<div class="section section-4 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Platform-specificJSfiles">
<h4 class="heading "><span>Platform-specific JS files</span></h4>
<p>
Using platform-specific JS files is likely to be most useful when your code is <i class=" ">mostly different</i> across platforms. This removes long if...then blocks from your main code. Separating platform-specific code reduces the chances of an error that comes from accidentally using the wrong platform's API or property. However, you'll have to remember to apply changes and fixes to <i class=" ">each</i> of the platform-specific files. So this approach could increase your work rather than reduce it.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var label2 = require(</code><code class="string">'ui'</code><code class="plain">).label;</code></div>
<div class="line"><code class="comments">// will include /android/ui.js on Android</code></div>
<div class="line"><code class="comments">// and /iphone/ui.js on iOS</code></div>
<div class="line"><code class="comments">// there doesn't even need to be a /ui.js file!</code></div>
</div>
</div> </div>
<div class="section section-4 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Platform-specificstyling">
<h4 class="heading "><span>Platform-specific styling</span></h4>
<p>
For simple projects, and those that don't use CommonJS <tt class=" ">require()</tt>, you can use JSS to create platform-specific layouts. Currently, however, our JSS implementation doesn't work well with <tt class=" ">require()</tt>. For more complex apps, you might consider using:    </p>
<ul class=" "><li class=" "> <p>
platform-specific JS files where you embed the platform-specific formatting within the component definitions.    </p>
</li><li class=" "> <p>
using the &quot;Tweetanium technique&quot; where you define a global style object, in which you store style settings determined with platform-branching code. Then, you use that object's properties when setting styles on your UI components.    </p>
</li></ul> </div>
</div>
</div>
<div class="section section-2 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Hands-onPractice">
<h2 class="heading "><span>Hands-on Practice</span></h2>
<div class="section section-3 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Goal">
<h3 class="heading "><span>Goal</span></h3>
<p>
In this activity, you will use platform-specific JavaScript style sheets files with a simple test project.    </p>
</div>
<div class="section section-3 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Steps">
<h3 class="heading "><span>Steps</span></h3>
<ol class=" "><li class=" "> <p>
Create a new mobile project named Platform Test. Replace all of the code in app.js with:\    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win = Ti.UI.createWindow({ id:</code><code class="string">'mainwin'</code><code class="plain"> });</code></div>
<div class="line"><code class="plain">var label = Ti.UI.createLabel({ id:</code><code class="string">'ptlabel'</code><code class="plain"> });</code></div>
<div class="line"><code class="plain">win.add(label);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div></li><li class=" "> <p>
Create two new files, one named app.iphone.js and the other named app.android.jss. In them, enter this code:\    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app.iphone.jss</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">#mainwin {</code></div>
<div class="line"><code class="plain">	background-color: </code><code class="string">'blue'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">#ptlabel {</code></div>
<div class="line"><code class="plain">	color:</code><code class="string">'#fff'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	top:</code><code class="value">10</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	width:</code><code class="string">'auto'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	height:</code><code class="string">'auto'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	text:</code><code class="string">'I am iPhone!'</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div><div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app.android.jss</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">#mainwin {</code></div>
<div class="line"><code class="plain">	background-color: </code><code class="string">'#f00'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">#ptlabel {</code></div>
<div class="line"><code class="plain">	color:</code><code class="string">'#fff'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	top:</code><code class="value">10</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	width:</code><code class="string">'auto'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	height:</code><code class="string">'auto'</code><code class="plain">;</code></div>
<div class="line"><code class="plain">	text:</code><code class="string">'I am Android!'</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li><li class=" "> <p>
Build the project for both the iPhone and Android simulator/emulator (if your development computer supports both). The labels and colors should be specific to the platforms as set in the stylesheets.    </p>
</li></ol> </div>
<div class="section section-3 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-ReferencesandFurtherReading">
<h3 class="heading "><span>References and Further Reading</span></h3>
<ul class=" "><li class=" "> <p>
<a class="external-link external-link" href="#!/api/Titanium.Platform">Ti.Platform reference</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://developer.appcelerator.com/blog/2011/06/new-defaults-for-android-layouts-in-1-7.html" target="_blank">Android UI scaling</a> </p>
</li></ul> </div>
</div>
<div class="section section-2 " id="29004890_SupportingMultiplePlatformsinaSingleCodebase-Summary">
<h2 class="heading "><span>Summary</span></h2>
<p>
In this section, you learned how to support both Android and iOS within a single set of files. You learned programming strategies as well as the ways Titanium eases the process of working with platform-specific resources. In the final section of this chapter, we'll see how we can use Titanium's integrated internationalization capabilities to make out app's global accessible.    </p>
</div>
</div>
<div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence" target="_blank">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
</div>
</body>
</html>
