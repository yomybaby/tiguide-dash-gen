<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>MVC Style App Framework</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Scroll EclipseHelp Exporter" name="generator" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" media="print" />
</head>
<body>
<div class="container">
<div class="header"></div>
<div id="30085346" class="content"><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=30085346"><span>Edit</span></a>
<h1>MVC Style App Framework</h1>
<div class="section section-2 " id="30085346_MVCStyleAppFramework-Download">
<h2 class="heading "><span>Download</span></h2>
<p>
You can download the project scaffold described below by clicking here: <a class="attachment-link " href="attachments_30278161_1_scaffold.zip" attachments_30278161_1_scaffold.zip="attachments_30278161_1_scaffold.zip">scaffold.zip</a> </p>
</div>
<div class="section section-2 " id="30085346_MVCStyleAppFramework-CoreConceptsandConventions">
<h2 class="heading "><span>Core Concepts and Conventions</span></h2>
<p>
This sample framework adapts a model-view-controller architecture, defines an event architecture, and defines an object inheritance pattern. It is not a pure MVC implementation. It also was created prior to our adoption of CommonJS require() as the preferred technique. Still, it is an instructive model and has been used successfully for Appcelerator-led projects.    </p>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-StandardPatterns">
<h3 class="heading "><span>Standard Patterns</span></h3>
<p>
The use of several patterns will be required throughout this app. For overall object or 'class' construction, a revealing module pattern will be used. Self-invoking functions for singleton objects will be used. For instantiable objects, the 'new' keyword should be used.    </p>
<p>
Example of a revealing module pattern:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">App.Models.Messages = function(someId) {</code></div>
<div class="line"><code class="plain">	var id = someId;</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Member method</code></div>
<div class="line"><code class="plain">    function getLatestMessages() {</code></div>
<div class="line"><code class="plain">        var data = [</code></div>
<div class="line"><code class="plain">            { text: </code><code class="string">'This is a test'</code><code class="plain"> },</code></div>
<div class="line"><code class="plain">            { text: </code><code class="string">'This is a test 2'</code><code class="plain"> },</code></div>
<div class="line"><code class="plain">            { text: </code><code class="string">'This is a test 3'</code><code class="plain"> }</code></div>
<div class="line"><code class="plain">        ];</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> data;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Return this object's 'public API'</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">        getLatestMessages: getLatestMessages,</code></div>
<div class="line"><code class="plain">        id: someId</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"><code class="comments">// This example must be instantiated using the 'new' keyword</code></div>
<div class="line"><code class="plain">var model = </code><code class="keyword">new</code><code class="plain"> App.Models.Messages(</code><code class="value">32</code><code class="plain">);</code></div>
</div>
</div> <p>
If inheritance is needed for any reason then those parent objects will be built with <tt class=" ">this</tt> prepended to its public methods / properties. The use of apply/call will be used to inherit methods in to child objects. Due to Titanium's poor performance around mixins, mixin type inheritance shouldn't be used unless it is for small objects.    </p>
</div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-GlobalNamespace">
<h3 class="heading "><span>Global Namespace</span></h3>
<p>
As a general rule, you should add as few objects to the global scope as you can. Such a practice makes garbage collection easier and lessens opportunities for name conflicts / crashes. Additionally, you should <i class=" ">not modify the Titanium proxy objects</i>, such as Ti.App, by adding properties or methods. To account for these design constraints, this app framework creates a single global <tt class=" ">App</tt> object to which you may append objects as needed. While there may be times when another global object is needed, everything will be placed in this namespace and documented in order to stay organized and avoid conflicts. e.g. App.Controllers = {}; would be where we store controllers for this app.    </p>
</div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-Models">
<h3 class="heading "><span>Models</span></h3>
<p>
Models are the data layer for this app. They can serve as two types: instantiable objects that can be reused across the app or as a PDO type object that stores data in memory for the lifetime of the app. Data logic should be offloaded in these objects as much as possible.    </p>
</div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-UIandStyles">
<h3 class="heading "><span>UI and Styles</span></h3>
<p>
UI files serve as the 'view' areas of the app. They will control any logic for aesthetic events (e.g. a highlight state), setting UI specific things such as a controller calling UI.setTitle('Cool beans') to change the title in the UI. They also serve for TiUI object creation and management.    </p>
<p>
Every UI file will have a corresponding 'styles' file. The styles file is an object literal that contains the object properties used to populate UI elements.    </p>
</div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-Controllers">
<h3 class="heading "><span>Controllers</span></h3>
<p>
Controllers are the main level business of the app. Controllers will manage the UI and model delegation for screens and components across an app. Some controllers may be global to the app and others instantiable, invoked when using a certain part of the app.    </p>
</div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-Modules">
<h3 class="heading "><span>Modules</span></h3>
<p>
Modules are CommonJS files that can be dropped in to the project for use. An effort will be made to ensure app widgets are modules so we can reuse them elsewhere in the future. Modules will be contained in their own folder with their own set of files if needed and assets.    </p>
</div>
</div>
<div class="section section-2 " id="30085346_MVCStyleAppFramework-Events">
<h2 class="heading "><span>Events</span></h2>
<p>
UI, models, and controllers will maintain their own internal events except when needed for global, app-wide cases. UI events will be related to aesthetics, UI state, and other similar functionality. Controller events will manage things in it's internal workings. Model events will mostly fire / update observers that are listening for data changes (mostly in the controller)    </p>
<p>
Global events will not be placed inside instantiable objects. Global events will be tracked in the global namespace. A good example is the orientation event placed in app.js. It fires a global function located in /lib/app.js 'orientationObserverUpdate'. This listener manages all objects that might have an orientation requirement. The 'orientationObserverUpdate' can fire a current controller or UI object that has an orientation function. e.g. 'currentController.orientationUpdate():' or 'currentController.UI.orientationUpdate();'    </p>
</div>
<div class="section section-2 " id="30085346_MVCStyleAppFramework-ManagingOrientationUI">
<h2 class="heading "><span>Managing Orientation UI</span></h2>
<p>
Titanium doesn't handle different layouts in orientation very well (because of absence of NIB files, etc.) so care must be taken in how this is setup. The design for this project isn't overly complex so it likely won't be a factor. Orientation management will be handled in two ways:    </p>
<ol class=" "><li class=" "> <p>
Via the controller &ndash; For complex orientation handling the controller will need an 'orientationUpdate()' method. This will handle all orientation needs the controller is managing.    </p>
</li><li class=" "> <p>
Via the UI &ndash; This is the most common scenario. The orientationObserverUpdate method will check if the current controller's UI and other listening objects have an orientationUpdate() method in the UI namespace. If so it will fire them and the UI will update accordingly. NOTE: See /ui/dashboard/dashboard.js for an example.    </p>
</li></ol> <p>
Either method above will pass a landscape / portrait argument which can be used by the UI's corresponding style sheet. e.g.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">function orientationUpdate(type) {</code></div>
<div class="line"><code class="plain">    wrapper.height = App.Styles.Example[type].wrapper.height;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">Orientation specific styles will be separated like so:</code></div>
<div class="line"><code class="plain">App.Styles.Example = {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Orientation specific</code></div>
<div class="line"><code class="plain">    portrait: {</code></div>
<div class="line"><code class="plain">    	wrapper: {</code></div>
<div class="line"><code class="plain">    		height: </code><code class="value">100</code></div>
<div class="line"><code class="plain">    	}</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    landscape: {</code></div>
<div class="line"><code class="plain">    	wrapper: {</code></div>
<div class="line"><code class="plain">    		height: </code><code class="string">'auto'</code></div>
<div class="line"><code class="plain">    	}</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Defaults (probably won't be necessar once we have a global property of current orientation)</code></div>
<div class="line"><code class="plain">    wrapper: {</code></div>
<div class="line"><code class="plain">        height: </code><code class="string">'auto'</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">};</code></div>
</div>
</div> </div>
<div class="section section-2 " id="30085346_MVCStyleAppFramework-Managingcross-platformandformfactorfiles">
<h2 class="heading "><span>Managing cross-platform and form factor files</span></h2>
<p>
There are several conventions to follow when building against different platforms and form factors:    </p>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-FormFactors">
<h3 class="heading "><span>Form Factors</span></h3>
<p>
Conditionals can be built off of the different form factors for this app, i.e. tablet / handheld. For hardcoded values you can simply use something like:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="keyword">if</code><code class="plain">(App.formFactor === </code><code class="string">'tablet'</code><code class="plain">) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// do something here</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
In many cases hard conditionals aren't needed since it's almost always related to UI branching. It's better to use the following:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// No conditionals needed</code></div>
<div class="line"><code class="plain">var wrapper = Ti.UI.createView(App.Styles.Example[formFactor].wrapper);</code></div>
<div class="line"><code class="plain">Branch by file </code><code class="keyword">if</code><code class="plain"> the UI or functionality in a form factor is drastically different:</code></div>
<div class="line"><code class="comments">// For a form factor e.g. dashboard.tablet.js</code></div>
<div class="line"><code class="plain">Ti.include(</code><code class="string">'ui/dashboard/dashboard.'</code><code class="plain"> + App.formFactor + </code><code class="string">'.js'</code><code class="plain">);</code></div>
<div class="line"><code class="comments">// Or if just a platform type is needed e.g. dashboard.ios.js</code></div>
<div class="line"><code class="plain">Ti.include(</code><code class="string">'ui/dashboard/dashboard.'</code><code class="plain"> + App.type + </code><code class="string">'.js'</code><code class="plain">);</code></div>
</div>
</div> </div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-Crossplatformandtypehandling">
<h3 class="heading "><span>Cross platform and type handling</span></h3>
<p>
In similar fashion, iOS / Android / Google TV, etc can be branched by either file or hard conditionals depending on the scenario.    </p>
<p>
A style.js example for the above scenarios with combined styles can look like this:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">App.Styles.Example = {</code></div>
<div class="line"><code class="plain">    menu: {</code></div>
<div class="line"><code class="plain">        handset: {</code></div>
<div class="line"><code class="plain">        	android: {</code></div>
<div class="line"><code class="plain">				buttonTrack: {</code></div>
<div class="line"><code class="plain">                	height: </code><code class="value">30</code><code class="plain">,</code></div>
<div class="line"><code class="plain">                	top: </code><code class="value">0</code></div>
<div class="line"><code class="plain">            	}</code></div>
<div class="line"><code class="plain">        	},</code></div>
<div class="line"><code class="plain">        	ios: {</code></div>
<div class="line"><code class="plain">        		buttonTrack: {</code></div>
<div class="line"><code class="plain">                	height: </code><code class="value">30</code></div>
<div class="line"><code class="plain">            	}</code></div>
<div class="line"><code class="plain">        	}</code></div>
<div class="line"><code class="plain">        },</code></div>
<div class="line"><code class="plain">        tablet: {</code></div>
<div class="line"><code class="plain">            buttonTrack: {</code></div>
<div class="line"><code class="plain">                height: </code><code class="value">100</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
To avoid excessive dirty nesting like the above example, branch by file will be used when it makes sense:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// This extreme example shows when an included file for a specific form factor AND platform is needed.</code></div>
<div class="line"><code class="comments">// Amounts to a file named 'style.handset.ios.js' for instance</code></div>
<div class="line"><code class="plain">Ti.include(</code><code class="string">'ui/dashboard/style.'</code><code class="plain"> + App.formFactor + </code><code class="string">'.'</code><code class="plain"> + App.type + </code><code class="string">'js'</code><code class="plain">);</code></div>
</div>
</div> </div>
</div>
<div class="section section-2 " id="30085346_MVCStyleAppFramework-The'App'Namespace">
<h2 class="heading "><span>The 'App' Namespace</span></h2>
<p>
There are numerous properties to be appended to the 'App' namespace. The following is an initial list:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">App.formFactor</tt> - Used for the different form factored layouts e.g. tablet / handheld    </p>
</li><li class=" "> <p>
<tt class=" ">App.API</tt> - Data endpoints and other API-ish things. A full set of App API areas for data (if needed). Good for storing PDO models and such.    </p>
</li><li class=" "> <p>
<tt class=" ">App.Models</tt> - Where models are stored    </p>
</li><li class=" "> <p>
<tt class=" ">App.Controllers</tt> - Where controllers are stored    </p>
</li><li class=" "> <p>
<tt class=" ">App.UI</tt> - UI components stored here    </p>
</li><li class=" "> <p>
<tt class=" ">App.Styles</tt> - Styles objects here    </p>
</li><li class=" "> <p>
<tt class=" ">App.Sidebar</tt> - Quick access to the sidebar module    </p>
</li><li class=" "> <p>
<tt class=" ">App.currentPanel</tt> - If using the GlobalPanels, this just tracks the current one open. Might not be needed.    </p>
</li><li class=" "> <p>
<tt class=" ">App.Plugins</tt> - Place to put 3rd party plugins that don't fall in the category of a module or anything else.    </p>
</li><li class=" "> <p>
<tt class=" ">App.Window</tt> - The global window this app uses    </p>
</li><li class=" "> <p>
<tt class=" ">App.currentOrientation</tt> - The Current orientation landscape || portrait    </p>
</li><li class=" "> <p>
<tt class=" ">App.Header</tt> - The top navigation area    </p>
</li><li class=" "> <p>
<tt class=" ">App.boot</tt> - Handles booting up the app once things are loaded in    </p>
</li><li class=" "> <p>
<tt class=" ">App.globalTopNavigationObserver</tt> - Handles global event for sidebar flyouts    </p>
</li><li class=" "> <p>
<tt class=" ">App.sidebarMenuObserver</tt> - Handles global event for sidebar menus    </p>
</li><li class=" "> <p>
<tt class=" ">App.onAfterAuthentication</tt> - Handles authentication routing after authentication is confirmed    </p>
</li><li class=" "> <p>
<tt class=" ">App.orientationObserverUpdate</tt> - Handles orientation update    </p>
</li></ul> <div class="section section-3 " id="30085346_MVCStyleAppFramework-App.API">
<h3 class="heading "><span>App.API</span></h3>
<p>
This area handles the data layers of the app.    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">setupDatabase</tt> - Sets up a local sqlite database schema    </p>
</li><li class=" "> <p>
<tt class=" ">DB</tt> - The data ORM endpoint (using the Joli plugin)    </p>
</li><li class=" "> <p>
<tt class=" ">Salesforce</tt> - Endpoint for all salesforce calls. This includes the salesforce module and the evently module    </p>
</li><li class=" "> <p>
<tt class=" ">tableSchemas</tt> - Stores the field names / schema for the database    </p>
</li><li class=" "> <p>
<tt class=" ">sessionRefresh</tt> - This will try to log in the previously logged in user    </p>
</li><li class=" "> <p>
<tt class=" ">syncModel</tt> - Syncs the supplied data to local storage    </p>
</li><li class=" "> <p>
<tt class=" ">syncFullEvent</tt> - Sync full event (all models: sessions, registration, etc)    </p>
</li></ul> </div>
<div class="section section-3 " id="30085346_MVCStyleAppFramework-App.Platform">
<h3 class="heading "><span>App.Platform</span></h3>
<p>
This endpoint has several features that help determine things like logic branching based on platform, device type, etc. This endpoint uses the platform module. Some useful examples of how this can be used:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var orientationModes = App.Platform.is({</code></div>
<div class="line"><code class="plain">  handheld:[Ti.UI.PORTRAIT],</code></div>
<div class="line"><code class="plain">  tablet:[Ti.UI.LANDSCAPE_LEFT, Ti.UI.LANDSCAPE_RIGHT]</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">var pointOffset = iApp.Platform.s({</code></div>
<div class="line"><code class="plain">  ios:</code><code class="value">100</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  android:</code><code class="value">120</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">App.Platform.is({</code></div>
<div class="line"><code class="plain">  handheld: {</code></div>
<div class="line"><code class="plain">    ios: function() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">//do iphone/ipod stuff</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    android: function() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">//do android handheld stuff</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  },</code></div>
<div class="line"><code class="plain">  tablet: {</code></div>
<div class="line"><code class="plain">    ios: function() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">//do ipad stuff</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    android: function() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">//do android tablet stuff</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  }</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div> </div>
</div>
</div>
<div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence" target="_blank">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
</div>
</body>
</html>
