<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Lightweight Persistence with the Properties API</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Scroll EclipseHelp Exporter" name="generator" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" media="print" />
</head>
<body>
<div class="container">
<div class="header"></div>
<div id="29004900" class="content"><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=29004900"><span>Edit</span></a>
<h1>Lightweight Persistence with the Properties API</h1>
<div class="section section-2 " id="29004900_LightweightPersistencewiththePropertiesAPI-Objective">
<h2 class="heading "><span>Objective</span></h2>
<p>
In this chapter, we'll dig deep into the <tt class=" ">Ti.App.Properties</tt> API. You'll learn how to store both simple and complex data in app properties and retrieve that data later.    </p>
</div>
<div class="section section-2 " id="29004900_LightweightPersistencewiththePropertiesAPI-Contents">
<h2 class="heading "><span>Contents</span></h2>
<p>
Both iOS and Android store app properties in special files on the filesystem. Natively, iOS properties are known as <tt class=" ">NSUserDefaults</tt>, which are stored in <tt class=" ">.plist</tt> files in the application's library directory. Android stores them in standard xml text files at <tt class=" ">/data/data/com.domainname.appname/shared_prefs/titanium.xml</tt>. Titanium provides a uniform means to set and get app properties via the <tt class=" ">Titanium.App.Properties</tt> API.    </p>
<div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
<p>
There isn't a specific limit on the amount of data you can store in properties. However, an application's property data is loaded into memory as the application launches, and exists there until it closes. This allows very rapid access to it, but at the cost of the increased baseline memory used by the application.    </p>
</div>
<div class="section section-3 " id="29004900_LightweightPersistencewiththePropertiesAPI-ReadingandWritingProperties">
<h3 class="heading "><span>Reading and Writing Properties</span></h3>
<p>
<tt class=" ">Titanium.App.Properties</tt> has six sets of get/set methods for handling six different data types:    </p>
<ul class=" "><li class=" "> <p>
<strong class=" ">getBool() / setBool()</strong>: for booleans (true, false)    </p>
</li><li class=" "> <p>
<strong class=" ">getDouble() / setDouble()</strong>: for double-precision floating point numbers    </p>
</li><li class=" "> <p>
<strong class=" ">getInt() / setInt()</strong>: for integers    </p>
</li><li class=" "> <p>
<strong class=" ">getList() / setList()</strong>: for arrays    </p>
</li><li class=" "> <p>
<strong class=" ">getString() / setString()</strong>: for strings    </p>
</li></ul> <p>
The <i class=" ">get</i> methods accept a property name and its default value. Thus, if a property has never been set before, the default value will be returned. Each <i class=" ">set</i> method requires a property name and property value pair. All of these methods are demonstrated below:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var window = Titanium.UI.createWindow({</code></div>
<div class="line"><code class="plain">  backgroundColor:</code><code class="string">'#999'</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">var myArray = [ { name:</code><code class="string">'Name 1'</code><code class="plain">, address:</code><code class="string">'1 Main St'</code><code class="plain">}, {name:</code><code class="string">'Name 2'</code><code class="plain">, address:</code><code class="string">'2 Main St'</code><code class="plain">}, {name:</code><code class="string">'Name 3'</code><code class="plain">, address:</code><code class="string">'3 Main St'</code><code class="plain">}, {name:</code><code class="string">'Name 4'</code><code class="plain">, address:</code><code class="string">'4 Main St'</code><code class="plain"> } ];</code></div>
<div class="line"><code class="plain">Ti.App.Properties.setString(</code><code class="string">'myString'</code><code class="plain">,</code><code class="string">'This is a string'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">Ti.App.Properties.setInt(</code><code class="string">'myInt'</code><code class="plain">,</code><code class="value">10</code><code class="plain">);</code></div>
<div class="line"><code class="plain">Ti.App.Properties.setBool(</code><code class="string">'myBool'</code><code class="plain">,</code><code class="keyword">true</code><code class="plain">);</code></div>
<div class="line"><code class="plain">Ti.App.Properties.setDouble(</code><code class="string">'myDouble'</code><code class="plain">,</code><code class="value">10.6</code><code class="plain">);</code></div>
<div class="line"><code class="plain">Ti.App.Properties.setList(</code><code class="string">'myList'</code><code class="plain">,myArray);</code></div>
<div class="line"><code class="comments">// **********************************************</code></div>
<div class="line"><code class="comments">// Notice the use of the second argument of the get* methods below</code></div>
<div class="line"><code class="comments">// that would be returned if no property exists with that name</code></div>
<div class="line"><code class="comments">// **********************************************</code></div>
<div class="line"><code class="plain">Ti.API.info(</code><code class="string">"String: "</code><code class="plain">+Ti.App.Properties.getString(</code><code class="string">'myString'</code><code class="plain">,</code><code class="string">'This is a string default'</code><code class="plain">));</code></div>
<div class="line"><code class="plain">Ti.API.info(</code><code class="string">"Integer: "</code><code class="plain">+Ti.App.Properties.getInt(</code><code class="string">'myInt'</code><code class="plain">,</code><code class="value">20</code><code class="plain">));</code></div>
<div class="line"><code class="plain">Ti.API.info(</code><code class="string">"Boolean: "</code><code class="plain">+Ti.App.Properties.getBool(</code><code class="string">'myBool'</code><code class="plain">,</code><code class="keyword">false</code><code class="plain">));</code></div>
<div class="line"><code class="plain">Ti.API.info(</code><code class="string">"Double: "</code><code class="plain">+Ti.App.Properties.getDouble(</code><code class="string">'myDouble'</code><code class="plain">,</code><code class="value">20.6</code><code class="plain">));</code></div>
<div class="line"><code class="plain">Ti.API.info(</code><code class="string">"List: "</code><code class="plain">+Ti.App.Properties.getList(</code><code class="string">'myList'</code><code class="plain">));</code></div>
<div class="line"><code class="plain">window.open();</code></div>
</div>
</div> <p>
This code outputs the following results:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">String: This is a string</code></div>
<div class="line"><code class="plain">Integer: </code><code class="value">10</code></div>
<div class="line"><code class="plain">Boolean: </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">Double: </code><code class="value">10.600000381469727</code></div>
<div class="line"><code class="plain">List:</code></div>
<div class="line"><code class="plain">  {  </code><code class="string">'address'</code><code class="plain"> :  </code><code class="string">'1 Main St'</code><code class="plain"> </code><code class="string">'name'</code><code class="plain"> :  </code><code class="string">'Name 1'</code><code class="plain">, },</code></div>
<div class="line"><code class="plain">  {  </code><code class="string">'address'</code><code class="plain"> :  </code><code class="string">'2 Main St'</code><code class="plain"> </code><code class="string">'name'</code><code class="plain"> :  </code><code class="string">'Name 2'</code><code class="plain">, },</code></div>
<div class="line"><code class="plain">  {  </code><code class="string">'address'</code><code class="plain"> :  </code><code class="string">'3 Main St'</code><code class="plain"> </code><code class="string">'name'</code><code class="plain"> :  </code><code class="string">'Name 3'</code><code class="plain">, },</code></div>
<div class="line"><code class="plain">  {  </code><code class="string">'address'</code><code class="plain"> :  </code><code class="string">'4 Main St'</code><code class="plain"> </code><code class="string">'name'</code><code class="plain"> :  </code><code class="string">'Name 4'</code><code class="plain">, }</code></div>
</div>
</div> </div>
<div class="section section-3 " id="29004900_LightweightPersistencewiththePropertiesAPI-StoringJSobjectsasJSONinproperties">
<h3 class="heading "><span>Storing JS objects as JSON in properties</span></h3>
<p>
If you have a complex Javascript object, you can convert it to a <a class="external-link external-link" href="http://en.wikipedia.org/wiki/JSON" target="_blank">JSON</a> string using <tt class=" ">JSON.stringify()</tt> provided by <a class="external-link external-link" href="http://developer.appcelerator.com/apidoc/desktop/latest/Titanium.JSON" target="_blank">Titanium.JSON</a>, which will allow you to store it in the database using the <a class="external-link external-link" href="#!/api/Titanium.App.Properties-method-setString">Titanium.App.Properties.setString()</a> method.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var window = Titanium.UI.createWindow({</code></div>
<div class="line"><code class="plain">  backgroundColor:</code><code class="string">'#999'</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">var weatherData = { </code><code class="string">"reports"</code><code class="plain"> : [ { </code><code class="string">"city"</code><code class="plain">: </code><code class="string">"Mountain View"</code><code class="plain">, </code><code class="string">"condition"</code><code class="plain">: </code><code class="string">"Cloudy"</code><code class="plain">, </code><code class="string">"icon"</code><code class="plain">: </code><code class="string">"http://www.worldweather.org/img_cartoon/pic23.gif"</code><code class="plain"> }, { </code><code class="string">"city"</code><code class="plain">: </code><code class="string">"Washington, DC"</code><code class="plain">, </code><code class="string">"condition"</code><code class="plain">: </code><code class="string">"Mostly Cloudy"</code><code class="plain">, </code><code class="string">"icon"</code><code class="plain">: </code><code class="string">"http://www.worldweather.org/img_cartoon/pic20.gif"</code><code class="plain"> }, { </code><code class="string">"city"</code><code class="plain">: </code><code class="string">"Brasilia"</code><code class="plain">, </code><code class="string">"condition"</code><code class="plain">: </code><code class="string">"Thunderstorm"</code><code class="plain">, </code><code class="string">"icon"</code><code class="plain">: </code><code class="string">"http://www.worldweather.org/img_cartoon/pic02.gif"</code><code class="plain"> } ] };</code></div>
<div class="line"><code class="plain">Ti.App.Properties.setString(</code><code class="string">'myJSON'</code><code class="plain">, JSON.stringify(weatherData));</code></div>
<div class="line"><code class="plain">var retrievedJSON=Ti.App.Properties.getString(</code><code class="string">'myJSON'</code><code class="plain">, </code><code class="string">'myJSON not found'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">Ti.API.info(</code><code class="string">"The myJSON property contains: "</code><code class="plain"> + retrievedJSON);</code></div>
<div class="line"><code class="plain">window.open();</code></div>
</div>
</div> <p>
This will output the following to the log:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">The myJSON property contains: {</code><code class="string">"reports"</code><code class="plain">:[{</code><code class="string">"city"</code><code class="plain">:</code><code class="string">"Mountain View"</code><code class="plain">,</code><code class="string">"condition"</code><code class="plain">:</code><code class="string">"Cloudy"</code><code class="plain">,</code><code class="string">"icon"</code><code class="plain">:</code><code class="string">"http://www.worldweather.org/img_cartoon/pic23.gif"</code><code class="plain">},{</code><code class="string">"city"</code><code class="plain">:</code><code class="string">"Washington, DC"</code><code class="plain">,</code><code class="string">"condition"</code><code class="plain">:</code><code class="string">"Mostly Cloudy"</code><code class="plain">,</code><code class="string">"icon"</code><code class="plain">:</code><code class="string">"http://www.worldweather.org/img_cartoon/pic20.gif"</code><code class="plain">},{</code><code class="string">"city"</code><code class="plain">:</code><code class="string">"Brasilia"</code><code class="plain">,</code><code class="string">"condition"</code><code class="plain">:</code><code class="string">"Thunderstorm"</code><code class="plain">,</code><code class="string">"icon"</code><code class="plain">:</code><code class="string">"http://www.worldweather.org/img_cartoon/pic02.gif"</code><code class="plain">}]}</code></div>
</div>
</div> <p>
This stored JSON string can later be converted back to a Javascript object using <tt class=" ">JSON.parse()</tt>:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var myObject = JSON.parse(Ti.App.Properties.getString(</code><code class="string">'myJSON'</code><code class="plain">));</code></div>
</div>
</div> </div>
<div class="section section-3 " id="29004900_LightweightPersistencewiththePropertiesAPI-Hands-onPractice">
<h3 class="heading "><span>Hands-on Practice</span></h3>
<div class="section section-4 " id="29004900_LightweightPersistencewiththePropertiesAPI-Goal">
<h4 class="heading "><span>Goal</span></h4>
<p>
In this activity, you will write an app that prompts the user to select temperature units in either Celsius or Fahrenheit and then save that preference in an application property. When the app is loaded, the property should be read and used to update the UI accordingly. When complete, your app should look like the following:         <img src="images/download/attachments/29004900/Screen_shot_2011-08-16_at_11.34.29_AM.png" alt="images/download/attachments/29004900/Screen_shot_2011-08-16_at_11.34.29_AM.png" class="confluence-embedded-image image-right" />
</p>
</div>
<div class="section section-4 " id="29004900_LightweightPersistencewiththePropertiesAPI-Steps">
<h4 class="heading "><span>Steps</span></h4>
<ol class=" "><li class=" "> <p>
Create a new Titanium Mobile project named <tt class=" ">localdata</tt> with an app ID of <tt class=" ">com.appcelerator.localdata</tt> </p>
</li><li class=" "> <p>
In app.js, follow our recommended coding best-practices to create a two-tabbed application with tabs titled Current Conditions and Units. You can omit the tab icons.    </p>
</li><li class=" "> <p>
Define and assign a window to the Current Conditions tab, but you can leave that window empty. We'll use it in the 5.3 lab that follows.    </p>
</li><li class=" "> <p>
Define and assign a window to the Units tab with the following characteristics:    </p>
<ul class=" "><li class=" "> <p>
Define and add a label with these properties:<br />color:'black'<br />text:'Fahrenheit'<br />font:{fontSize:22,fontFamily:'Helvetica Neue', fontWeight:'bold'}<br />left: 10<br />top:5<br />height:25    </p>
</li><li class=" "> <p>
Define and add a &quot;sub&quot; label with these properties:<br />color:'black'<br />text:'Output will be shown in Celsius'<br />font:{fontSize:18,fontFamily:'Helvetica Neue'}<br />left: 10<br />top:40<br />height:20    </p>
</li><li class=" "> <p>
Define and add a switch positioned at <tt class=" ">right:10</tt>, <tt class=" ">top:5</tt> with an <tt class=" ">auto</tt> width. Its value should be a zero or one depending on the value of the <tt class=" ">units</tt> app property. If that property equals <tt class=" ">c</tt>, set the switch value to <tt class=" ">0</tt>, otherwise set it to <tt class=" ">1</tt>.    </p>
</li></ul></li><li class=" "> <p>
Add an event handler to the switch: if the switch value is <tt class=" ">1</tt>, update the sub-label text to read 'Output will be shown in Fahrenheit' and set the <tt class=" ">units</tt> app property equal to <tt class=" ">f</tt>. If the value of the switch is <tt class=" ">0</tt>, update the sub-label text to read 'Output will be shown in Celsius' and set the <tt class=" ">units</tt> app property equal to <tt class=" ">c</tt>.    </p>
</li><li class=" "> <p>
Build your app for the simulator/emulator. The output should match the preceding picture. When you change the switch, the label should update. Close the app. When you re-open it, your preference should be saved and reloaded.    </p>
</li></ol> </div>
</div>
<div class="section section-3 " id="29004900_LightweightPersistencewiththePropertiesAPI-ReferencesandFurtherReading">
<h3 class="heading "><span>References and Further Reading</span></h3>
<ul class=" "><li class=" "> <p>
<a class="external-link external-link" href="#!/api/Titanium.App.Properties">API Docs: Properties</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://assets.appcelerator.com.s3.amazonaws.com/app_u/ebook/5.2_localdata.zip" target="_blank">Finished code</a> </p>
</li></ul> </div>
</div>
<div class="section section-2 " id="29004900_LightweightPersistencewiththePropertiesAPI-Summary">
<h2 class="heading "><span>Summary</span></h2>
<p>
In this chapter, we dug into the <tt class=" ">Ti.App.Properties</tt> API. You learned how to store both simple and complex data in app properties and retrieve that data later.    </p>
</div>
</div>
<div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence" target="_blank">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
</div>
</body>
</html>
