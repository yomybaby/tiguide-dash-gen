<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Core Motion Module</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Scroll EclipseHelp Exporter" name="generator" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" />
<link type="text/css" rel="stylesheet" media="print" />
</head>
<body>
<div class="container">
<div class="header"></div>
<div id="38928815" class="content"><a id="editButton" href="https://wiki.appcelerator.org/pages/editpage.action?pageId=38928815"><span>Edit</span></a>
<h1>Core Motion Module</h1>
<p class="p1">
</p>
<ul class="toc-indentation "><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Introduction" Core_Motion_Module.html#38928815_CoreMotionModule-Introduction="Core_Motion_Module.html#38928815_CoreMotionModule-Introduction">Introduction </a> </p>
<ul class="toc-indentation "><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Requirements" Core_Motion_Module.html#38928815_CoreMotionModule-Requirements="Core_Motion_Module.html#38928815_CoreMotionModule-Requirements">Requirements</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Concepts" Core_Motion_Module.html#38928815_CoreMotionModule-Concepts="Core_Motion_Module.html#38928815_CoreMotionModule-Concepts">Concepts</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-CoordinateSystem" Core_Motion_Module.html#38928815_CoreMotionModule-CoordinateSystem="Core_Motion_Module.html#38928815_CoreMotionModule-CoordinateSystem">Coordinate System</a> </p>
</li></ul></li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-GettingStarted" Core_Motion_Module.html#38928815_CoreMotionModule-GettingStarted="Core_Motion_Module.html#38928815_CoreMotionModule-GettingStarted">Getting Started</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-UsingtheCoreMotionAPI" Core_Motion_Module.html#38928815_CoreMotionModule-UsingtheCoreMotionAPI="Core_Motion_Module.html#38928815_CoreMotionModule-UsingtheCoreMotionAPI">Using the Core Motion API</a> </p>
<ul class="toc-indentation "><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Callbacks" Core_Motion_Module.html#38928815_CoreMotionModule-Callbacks="Core_Motion_Module.html#38928815_CoreMotionModule-Callbacks">Callbacks</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-DeviceMotion" Core_Motion_Module.html#38928815_CoreMotionModule-DeviceMotion="Core_Motion_Module.html#38928815_CoreMotionModule-DeviceMotion">Device Motion</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Activity" Core_Motion_Module.html#38928815_CoreMotionModule-Activity="Core_Motion_Module.html#38928815_CoreMotionModule-Activity">Activity</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-StepCounter" Core_Motion_Module.html#38928815_CoreMotionModule-StepCounter="Core_Motion_Module.html#38928815_CoreMotionModule-StepCounter">Step Counter</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Accelerometer" Core_Motion_Module.html#38928815_CoreMotionModule-Accelerometer="Core_Motion_Module.html#38928815_CoreMotionModule-Accelerometer">Accelerometer</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Gyroscope" Core_Motion_Module.html#38928815_CoreMotionModule-Gyroscope="Core_Motion_Module.html#38928815_CoreMotionModule-Gyroscope">Gyroscope</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/Core_Motion_Module-section-38928815_CoreMotionModule-Magnetometer" Core_Motion_Module.html#38928815_CoreMotionModule-Magnetometer="Core_Motion_Module.html#38928815_CoreMotionModule-Magnetometer">Magnetometer</a> </p>
</li></ul></li></ul> <div class="section section-2 p2" id="38928815_CoreMotionModule-Introduction">
<h2 class="heading p2"><span>Introduction</span></h2>
<p class="p2">
The Core Motion module provides support for monitoring various hardware sensors on iOS devices, such as the accelerometer, gyroscope, and magnetometer.  The Core Motion module allows you to access the measurements provided by these sensors.    </p>
<div class="section section-3 p2" id="38928815_CoreMotionModule-Requirements">
<h3 class="heading p2"><span>Requirements</span></h3>
<p class="p2">
This module only works with devices running iOS 7.  Not all devices have the same hardware sensors, so all features may not be available for all devices.  Be sure to use the API to check the device for the existence of a feature.    </p>
<p class="p2">
You can only test the Core Motion module on a device.  The Core Motion API cannot be tested on the iOS simulator.    </p>
<p class="p2">
Some features may require permission to use &quot;Motion Activity&quot;. iOS requires the user's approval to use the &quot;Motion Activity&quot; permission. When the application uses the Core Motion API for the first time, iOS prompts the user to either approve or deny access to the Core Motion features of the device.  The user can change the permission settings with <strong class=" ">Settings &gt; Privacy</strong>.    </p>
</div>
<div class="section section-3 p2" id="38928815_CoreMotionModule-Concepts">
<h3 class="heading p2"><span>Concepts</span></h3>
<p>
An iOS device contains various sensors on it to measure and collect different measurements.  Most modern devices contain an accelerometer, gyroscope and magnetometer:    </p>
<ul class=" "><li class=" "> <p>
<strong class=" ">Accelerometer</strong>: The accelerometer measures the instantaneous g-force acceleration acting on the device along the three spatial axes. The accelerometer measures each force in G's (gravitational force or 9.81 m/s^2).  An accelerometer allows the software to know the orientation of the device.    </p>
</li><li class=" "> <p>
<strong class=" ">Gyroscope</strong>: The gyroscope measures the instantaneous rotation rate of the device.  The gyroscope measures the rotation rate of each individual axis in radians (360 degrees = 2 * pi radians).  The gyroscope improves the accuracy of recognizing movement in 3D space.    </p>
</li><li class=" "> <p>
<strong class=" ">Magnetometer</strong>: The magnetometer measures the strength and direction of magnetic fields in microteslas.  The device uses the magnetometer as a digital compass.    </p>
</li></ul> <p>
The measurement from these three sensors provide raw data that is used to calculate other useful measurements of the device:    </p>
<ul class=" "><li class=" "> <p>
<strong class=" ">Activity</strong>: The activity indicates the motion activity the user is currently doing with the device, such as walking, running or if the device is in an automobile.    </p>
</li><li class=" "> <p>
<strong class=" ">Attitude:</strong> Measurement of the orientation of the device relative to a frame of reference, represented as either Euler angles (roll, pitch and yaw), a rotation matrix, or a <a class="external-link external-link" href="http://en.wikipedia.org/wiki/Quaternion" target="_blank">quaternion</a>.    </p>
</li><li class=" "> <p>
<strong class=" ">Step Counter</strong>: Measures the number of steps the user has taken with the device.    </p>
</li><li class=" "> <p>
<strong class=" ">User Acceleration:</strong> Instantaneous acceleration force the user applies to the device.    </p>
</li></ul> </div>
<div class="section section-3 p1" id="38928815_CoreMotionModule-CoordinateSystem">
<h3 class="heading p1"><span>Coordinate System</span></h3>
<p>
The accelerometer and magnetometer measure forces along the three spatial axes. If you hold the device in portrait mode with the screen facing you:    </p>
<ul class=" "><li class=" "> <p>
The X-axis runs along the width of the screen in the center of the device. Positive values are to the right and negative values are to the left.  For example, landscape left reports positive values and landscape right reports negative values. Note that the left and right names come from the location of the home button, not the edge of the device.    </p>
</li><li class=" "> <p>
The Y-axis runs along the height of the screen in the center of the device. Positive values are up and negative values are down. For example, upside down mode reports positive values and portrait mode reports negative values.    </p>
</li><li class=" "> <p>
The Z-axis runs through the screen and back of the device in the center of the device. Positive values are towards the screen and negative values are behind the device.  For example, face down reports positive values and face up reports negative values.    </p>
</li></ul> <p>
<img src="images/download/attachments/38928815/ForceCoordinateSystem.png" alt="images/download/attachments/38928815/ForceCoordinateSystem.png" class="gliffy-macro-image" width="658" />
</p>
<p>
The gyroscope measures forces along the three spatial axes.  If you hold the device in portrait mode with the screen facing you:    </p>
<ul class=" "><li class=" "> <p>
The X-axis runs along the width of the screen in the center of the device. Rotating the screen down indicates a positive rotation direction.    </p>
</li><li class=" "> <p>
The Y-axis runs along the height of the screen in the center of the device. Rotating the screen to the right indicates a positive rotation direction.    </p>
</li><li class=" "> <p>
The Z-axis runs through the screen and back of the device in the center of the device. Rotating the device to right landscape mode (left edge down) indicates a positive rotation direction.    </p>
</li></ul> </div>
</div>
<div class="section section-2 p2" id="38928815_CoreMotionModule-GettingStarted">
<h2 class="heading p2"><span>Getting Started</span></h2>
<p class="p1">
The Core Motion module is available as part of the Titanium SDK since Release 3.2.0.  To use core motion services in your application, add the module as a dependency to your application.    </p>
<ol class=" "><li class="p1 "> <p>
Modify the modules section of your <tt class=" ">tiapp.xml</tt> file to include the <tt class=" ">ti.coremotion</tt> module or add the module with Studio's TiApp Editor (see <a class="document-link " href="#!/guide/Using_a_Module" Using_a_Module.html="Using_a_Module.html">Using a Module</a>):    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">&lt;modules&gt;</code></div>
<div class="line"><code class="plain">    &lt;module platform=</code><code class="string">"iphone"</code><code class="plain">&gt;ti.coremotion&lt;/module&gt;</code></div>
<div class="line"><code class="plain">&lt;/modules&gt;</code></div>
</div>
</div> <p>
</p>
</li><li class="p1 "> <p>
Require in the module in your JavaScript code. Use the reference to make API calls to the module.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isStepCountingAvailable()) {</code></div>
<div class="line"><code class="plain">    CoreMotion.startStepCountingUpdates({stepCounts: </code><code class="value">1</code><code class="plain">}, function(e){</code></div>
<div class="line"><code class="plain">        step_label.text = e.numberOfSteps;</code></div>
<div class="line"><code class="plain">        Ti.API.info(JSON.stringify(e));</code></div>
<div class="line"><code class="plain">    });</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">    Ti.API.warn(</code><code class="string">'This device does not support counting steps.'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li></ol> </div>
<div class="section section-2 p2" id="38928815_CoreMotionModule-UsingtheCoreMotionAPI">
<h2 class="heading p2"><span>Using the Core Motion API</span></h2>
<p class="p2">
The <a class="external-link external-link" href="#!/api/Modules.CoreMotion">Core Motion API</a> breaks down in to the following six features:    </p>
<ul class=" "><li class="p2 "> <p>
<strong class=" ">Device Motion</strong>: access the device's data for attitude and user acceleration as well as the raw data sent by the accelerometer, gyroscope and magnetometer    </p>
</li><li class="p2 "> <p>
<strong class=" ">Activity</strong>: access the device's motion activity functionality    </p>
</li><li class="p2 "> <p>
<strong class=" ">Step Counter</strong>: access the device's step counting functionality    </p>
</li><li class="p2 "> <p>
<strong class=" ">Accelerometer</strong>: access the device's accelerometer measurements    </p>
</li><li class="p2 "> <p>
<strong class=" ">Gyroscope</strong>: access the device's rotation rate measurements    </p>
</li><li class="p2 "> <p>
<strong class=" ">Magnetometer</strong>: access the device's magnetic field measurements    </p>
</li></ul> <p class="p2">
Each core motion feature follows a basic sequence.  To use a core motion feature:    </p>
<ol class=" "><li class="p2 "> <p>
Query the device to see if the feature is available.  Use the feature's &quot;is available&quot; method.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isAccelerometerAvailable()) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Start the service</code></div>
<div class="line"><code class="plain">   accelerometer_state = </code><code class="keyword">true</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li><li class="p2 "> <p>
Start the service with or without a callback function to start collecting data.  Use the feature's &quot;start&quot; method.    </p>
<ol class=" "><li class="p2 "> <p>
If you start the service with a callback, use the feature's &quot;set interval&quot; method to determine how often the device sends data to the application. Note that pushing data from the device to the application requires a lot of CPU cycles.  The application may not be able to keep up with the data rate if the device moves rapidly.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// Send data at 1 s (1000 ms) intervals</code></div>
<div class="line"><code class="plain">CoreMotion.setAccelerometerUpdateInterval(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="comments">// Start with a callback</code></div>
<div class="line"><code class="plain">CoreMotion.startAccelerometerUpdates(updateAccelData);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">function updateAccelData (e) {</code></div>
<div class="line"><code class="plain">    data = e.acceleration;</code></div>
<div class="line"><code class="plain">    xLabel.text = data.x;</code></div>
<div class="line"><code class="plain">    yLabel.text = data.y;</code></div>
<div class="line"><code class="plain">    zLabel.text = data.z;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li><li class="p2 "> <p>
If you start the service without a callback, you need to periodically check for data with the feature's &quot;get&quot; or &quot;query&quot; method.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// Start without a callback and get data</code></div>
<div class="line"><code class="plain">CoreMotion.startAccelerometerUpdates();</code></div>
<div class="line"><code class="comments">// The user manually polls for data </code></div>
<div class="line"><code class="plain">button.addEventListener(</code><code class="string">'click'</code><code class="plain">, function(e) {</code></div>
<div class="line"><code class="plain">    updateAccelData(CoreMotion.getAccelerometerData());</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">function updateAccelData (e) {</code></div>
<div class="line"><code class="plain">    data = e.acceleration;</code></div>
<div class="line"><code class="plain">    xLabel.text = data.x;</code></div>
<div class="line"><code class="plain">    yLabel.text = data.y;</code></div>
<div class="line"><code class="plain">    zLabel.text = data.z;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li></ol></li><li class="p2 "> <p>
Stop the service when the application does not need to collect data.  Use the feature's &quot;stop&quot; method.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="keyword">if</code><code class="plain"> (acceleratormeter_state) {</code></div>
<div class="line"><code class="plain">    CoreMotion.stopAccelerometerUpdates();</code></div>
<div class="line"><code class="plain">    acceleratormeter_state = </code><code class="keyword">false</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li></ol> <div class="section section-3 " id="38928815_CoreMotionModule-Callbacks">
<h3 class="heading "><span>Callbacks</span></h3>
<p>
The Core Motion API performs asynchronous calls and relies on callback functions for responses.  The callbacks are passed a dictionary as its only argument.  The dictionary contains the following common properties:    </p>
<ul class=" "><li class=" "> <p>
code: Returns an error code if the method failed.  The value can be one of the following constants:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_DEVICE_REQUIRES_MOVEMENT</tt>: The device must move for a sampling of motion data to occur.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_INVALID_PARAMETER</tt>: An invalid parameter was specified.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_MOTION_ACTIVITY_NOT_AUTHORIZED</tt>: The app is not currently authorized to use motion activity support.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_MOTION_ACTIVITY_NOT_AVAILABLE</tt>: Motion activity support is not available on the current device.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_MOTION_ACTIVITY_NOT_ENTITLED</tt>: The app is missing a required entitlement.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_NULL</tt>: No error.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_TRUE_NORTH_NOT_AVAILABLE</tt>: True north is not available on this device. This usually indicates that the device's location is not yet available.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ERROR_UNKNOWN</tt>: An unknown error occurred.    </p>
</li></ul></li><li class=" "> <p>
<tt class=" ">error</tt>: Error message if any.    </p>
</li><li class=" "> <p>
<tt class=" ">success</tt>: Returns true if the method succeeded.    </p>
</li><li class=" "> <p>
<tt class=" ">timestamp</tt>: Logged time of the measurement. (Only for the &quot;get&quot; methods).    </p>
</li></ul> <p>
The dictionary also contains properties specific to each feature, reporting different measurements.    </p>
<p>
</p>
</div>
<div class="section section-3 " id="38928815_CoreMotionModule-DeviceMotion">
<h3 class="heading "><span>Device Motion</span></h3>
<p>
The Device Motion API captures data from the accelerometer, gyroscope and magnetometer to calculate the attitude of the device and the acceleration applied by the user to the device.    </p>
<p>
The Device Motion API provides the same interface as the other Core Motion APIs except the application can initialize the service with a specific reference frame for attitude calculations.  Use the <tt class=" ">availableAttitudeReferenceFrames</tt> method to retrieve a bitmask indicating the available reference frames.  Use the bitmask to bitwise-AND with a reference frame constant to check its availability.  The Device Motion API uses the following constants:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ATTITUDE_REFERENCE_FRAME_X_ARBITRARY_CORRECTED_Z_VERTICAL</tt>: Describes the same reference frame as <tt class=" ">ATTITUDE_REFERENCE_FRAME_X_ARBITRARY_Z_VERTICAL</tt> except that the magnetometer, when available and calibrated, is used to improve long-term yaw accuracy. Using this constant instead of <tt class=" ">ATTITUDE_REFERENCE_FRAME_X_ARBITRARY_Z_VERTICAL</tt> results in increased CPU usage.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ATTITUDE_REFERENCE_FRAME_X_ARBITRARY_Z_VERTICAL</tt>: Describes a reference frame in which the Z axis is vertical and the X axis points in an arbitrary direction in the horizontal plane.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ATTITUDE_REFERENCE_FRAME_X_MAGNETIC_NORTH_Z_VERTICAL</tt>: Describes a reference frame in which the Z axis is vertical and the X axis points toward magnetic north. Note that using this reference frame may require device movement to calibrate the magnetometer.    </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.ATTITUDE_REFERENCE_FRAME_X_TRUE_NORTH_Z_VERTICAL</tt>: Describes a reference frame in which the Z axis is vertical and the X axis points toward true north. Note that using this reference frame may require device movement to calibrate the magnetometer. It also requires the location to be available in order to calculate the difference between magnetic and true north.    </p>
</li></ul><div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// Check to see if the true north reference frame is available</code></div>
<div class="line"><code class="plain">var frames = CoreMotion.availableAttitudeReferenceFrames();</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (frames &amp; CoreMotion.ATTITUDE_REFERENCE_FRAME_X_TRUE_NORTH_Z_VERTICAL) {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">true</code><code class="plain">;</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">false</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
To retrieve the default reference frame, call the <tt class=" ">getAttitudeReferenceFrame</tt> method.    </p>
<p>
If the application gets a valid reference frame, use the <tt class=" ">startDeviceMotionUpdatesUsingReferenceFrame</tt> method to initialize the Device Motion API with the reference frame.  Pass a dictionary with one key-value pair as the first argument. Set the <tt class=" ">referenceFrame</tt> property to the reference frame constant you want to use.  Pass an optional callback as the second parameter to the method.    </p>
<p>
The Device Motion API uses five extra dictionaries to report the motion state of the device:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">attitude</tt>: Reports the orientation device in relation to a reference frame.  The attitude is reported as either a quaternion, rotation matrix; or the pitch, roll and yaw of the device.  The dictionary contains the following properties:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">pitch</tt>: Rotation of the device in radians along the X-axis.    </p>
</li><li class=" "> <p>
<tt class=" ">roll:</tt> Rotation of the device in radians along the Y-axis.    </p>
</li><li class=" "> <p>
<tt class=" ">yaw</tt>: Rotation of the device in radians along the Z-axis.    </p>
</li><li class=" "> <p>
<tt class=" ">quaternion</tt>: Quaternion representing the attitude of the device.  Contains four properties: <tt class=" ">w</tt>,<tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the values along the W-, X-, Y- and Z-axes, respectively.    </p>
</li><li class=" "> <p>
<tt class=" ">rotationMatrix</tt>: 2D matrix representing the attitude of the device.  Contains nine properties: <tt class=" ">m11</tt> to <tt class=" ">m33</tt>, representing the values of the matrix.    </p>
</li></ul></li><li class=" "> <p>
<tt class=" ">gravity</tt>: Same dictionary of values returned by the Accelerometer API.  Contains three properties: x, y and z, which provides the acceleration values in G's along the X-, Y- and Z-axes, respectively.    </p>
</li><li class=" "> <p>
<tt class=" ">magneticField</tt>: Same dictionary of values returned by the Magnetometer API.  Contains three properties: <tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the magnetic field values in microteslas along the X-, Y- and Z-axes, respectively.    </p>
</li><li class=" "> <p>
<tt class=" ">rotationRate:</tt> Same dictionary of values returned by the Gyroscope API.  Contains three properties: <tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the rotational rates in radian along the X-, Y- and Z-axes, respectively.    </p>
</li><li class=" "> <p>
<tt class=" ">userAcceleration</tt>: Reports the acceleration applied by the user to the device.  Contains three properties: <tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the acceleration values in G's along the X-, Y- and Z-axes, respectively.    </p>
</li></ul> <p>
</p>
<div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
<p>
The Core Motion module is built using hyperloop. Currently, if you try to stringify a hyperloop object that does not directly contain primitive values, that is, it contains other objects, the application freezes or crashes without reporting an error. For example:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// Succeeds</code></div>
<div class="line"><code class="plain">JSON.stringify(attitude.rotationMatrix);</code></div>
<div class="line"><code class="plain">JSON.stringify(attitude.quaternion);</code></div>
<div class="line"><code class="comments">// Fails</code></div>
<div class="line"><code class="plain">JSON.stringify(attitude);</code></div>
</div>
</div> </div>
<p>
</p>
<div class="section section-4 " id="38928815_CoreMotionModule-Example">
<h4 class="heading "><span>Example</span></h4>
<p>
The sample below initializes the Device Motion API with the specified reference frame.  If the frame is not available, the application falls back to the default frame or no frame.  If the user shakes the device for about 3 s, the application determines the direction the user is shaking, based on the user acceleration data.  The application outputs the attitude data to the display.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app/views/index.xml</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">&lt;Alloy&gt;</code></div>
<div class="line"><code class="plain">    &lt;Window backgroundColor=</code><code class="string">"white"</code><code class="plain"> layout=</code><code class="string">"vertical"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">        &lt;Label&gt;Pitch:&lt;/Label&gt;</code></div>
<div class="line"><code class="plain">        &lt;ProgressBar id=</code><code class="string">"pitch"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">        &lt;Label&gt;Roll:&lt;/Label&gt;</code></div>
<div class="line"><code class="plain">        &lt;ProgressBar id=</code><code class="string">"roll"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">        &lt;Label&gt;Yaw:&lt;/Label&gt;</code></div>
<div class="line"><code class="plain">        &lt;ProgressBar id=</code><code class="string">"yaw"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">    &lt;/Window&gt;</code></div>
<div class="line"><code class="plain">&lt;/Alloy&gt;</code></div>
</div>
</div><div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app/styles/index.tss</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="string">"ProgressBar"</code><code class="plain"> : {</code></div>
<div class="line"><code class="plain"> </code><code class="string">"top"</code><code class="plain"> : </code><code class="value">10</code><code class="plain">,</code></div>
<div class="line"><code class="plain"> </code><code class="string">"width"</code><code class="plain"> : </code><code class="value">200</code><code class="plain">,</code></div>
<div class="line"><code class="plain"> </code><code class="string">"min"</code><code class="plain"> : </code><code class="value">0</code><code class="plain">,</code></div>
<div class="line"><code class="plain"> </code><code class="string">"max"</code><code class="plain"> : </code><code class="value">3.1415927</code></div>
<div class="line"><code class="plain">},</code></div>
<div class="line"><code class="string">"Label"</code><code class="plain"> : {</code></div>
<div class="line"><code class="plain"> </code><code class="string">"font"</code><code class="plain"> : {</code></div>
<div class="line"><code class="plain">        textStyle: Ti.UI.TEXT_STYLE_SUBHEADLINE</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain"> </code><code class="string">"top"</code><code class="plain"> : </code><code class="value">50</code><code class="plain">,</code></div>
<div class="line"><code class="plain"> </code><code class="string">"left"</code><code class="plain"> : </code><code class="value">10</code></div>
<div class="line"><code class="plain">} </code></div>
</div>
</div> <p>
</p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app/controllers/index.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var accelX = accelY = accelZ = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">var lastX = lastY = lastZ = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">var ACCEL_THRESHOLD = </code><code class="value">2</code><code class="plain">;</code></div>
<div class="line"><code class="plain">var SHAKE_THRESHOLD = </code><code class="value">5</code><code class="plain">;</code></div>
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isDeviceMotionAvailable()) {</code></div>
<div class="line"><code class="plain">    CoreMotion.setDeviceMotionUpdateInterval(</code><code class="value">500</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    var frames = CoreMotion.availableAttitudeReferenceFrames();</code></div>
<div class="line"><code class="plain">    var ref_frame = CoreMotion.ATTITUDE_REFERENCE_FRAME_X_TRUE_NORTH_Z_VERTICAL;</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (frames &amp; ref_frame) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Use the True North Frame if available</code></div>
<div class="line"><code class="plain">        Ti.API.debug(</code><code class="string">'REFERENCE FRAME: True North'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CoreMotion.startDeviceMotionUpdatesUsingReferenceFrame(</code></div>
<div class="line"><code class="plain">            {referenceFrame: ref_frame},</code></div>
<div class="line"><code class="plain">            updateMotionData    </code></div>
<div class="line"><code class="plain">        );</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (ref_frame = CoreMotion.getAttitudeReferenceFrame()) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Use the default frame if it exists</code></div>
<div class="line"><code class="plain">        Ti.API.debug(</code><code class="string">'REFERENCE FRAME: Default '</code><code class="plain"> + ref_frame);</code></div>
<div class="line"><code class="plain">        CoreMotion.startDeviceMotionUpdatesUsingReferenceFrame(</code></div>
<div class="line"><code class="plain">            {referenceFrame: ref_frame},</code></div>
<div class="line"><code class="plain">            updateMotionData    </code></div>
<div class="line"><code class="plain">        );        </code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Do not use a reference frame</code></div>
<div class="line"><code class="plain">        Ti.API.debug(</code><code class="string">'REFERENCE FRAME: None'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        CoreMotion.startDeviceMotionUpdates(updateMotionData);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">function updateMotionData (e) {</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.success) {     </code></div>
<div class="line"><code class="plain">        var data = e.userAcceleration;</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (Math.abs(lastX - data.x) &gt; ACCEL_THRESHOLD) {</code></div>
<div class="line"><code class="plain">            accelX++;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (Math.abs(lastY - data.y) &gt; ACCEL_THRESHOLD) {</code></div>
<div class="line"><code class="plain">            accelY++;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (Math.abs(lastZ - data.z) &gt; ACCEL_THRESHOLD) {</code></div>
<div class="line"><code class="plain">            accelZ++;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        analyzeResults();</code></div>
<div class="line"><code class="plain">        lastX = data.x;</code></div>
<div class="line"><code class="plain">        lastY = data.y;</code></div>
<div class="line"><code class="plain">        lastZ = data.z;</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">        data = e.attitude;</code></div>
<div class="line"><code class="plain">        $.pitch.message = data.pitch;</code></div>
<div class="line"><code class="plain">        $.pitch.value = Math.abs(data.pitch);</code></div>
<div class="line"><code class="plain">        $.roll.message = data.roll;</code></div>
<div class="line"><code class="plain">        $.roll.value = Math.abs(data.roll);</code></div>
<div class="line"><code class="plain">        $.yaw.message = data.yaw;</code></div>
<div class="line"><code class="plain">        $.yaw.value = Math.abs(data.yaw);</code></div>
<div class="line"><code class="plain">    } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.error) Ti.API.error(e.error);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">function analyzeResults(){</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (accelX &gt; SHAKE_THRESHOLD || accelY &gt; SHAKE_THRESHOLD || accelZ &gt; SHAKE_THRESHOLD) {</code></div>
<div class="line"><code class="plain">        var err = SHAKE_THRESHOLD * </code><code class="value">0.5</code><code class="plain">;</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (accelX &gt; SHAKE_THRESHOLD &amp;&amp; (accelY &lt; err &amp;&amp; accelZ &lt; err)){</code></div>
<div class="line"><code class="plain">            alert(</code><code class="string">"Quit shaking me back and forth!"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (accelY &gt; SHAKE_THRESHOLD &amp;&amp; (accelX &lt; err &amp;&amp; accelZ &lt; err)){</code></div>
<div class="line"><code class="plain">            alert(</code><code class="string">"Quit shaking me up and down!"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (accelZ &gt; SHAKE_THRESHOLD &amp;&amp; (accelX &lt; err &amp;&amp; accelY &lt; err)){</code></div>
<div class="line"><code class="plain">            alert(</code><code class="string">"Why are you shaking me like that?!"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            alert(</code><code class="string">"Quit shaking me!"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }        </code></div>
<div class="line"><code class="plain">        accelX = accelY = accelZ = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">$.pitch.show();</code></div>
<div class="line"><code class="plain">$.roll.show();</code></div>
<div class="line"><code class="plain">$.yaw.show();</code></div>
<div class="line"><code class="plain">$.index.open();</code></div>
</div>
</div> <p>
<img src="images/download/attachments/38928815/devicemotion.png" alt="images/download/attachments/38928815/devicemotion.png" class="confluence-embedded-image" />
</p>
</div>
</div>
<div class="section section-3 " id="38928815_CoreMotionModule-Activity">
<h3 class="heading "><span>Activity</span></h3>
<p>
The Activity API determines what the motion-related activity the user is doing with the device and keeps a log of the activities.    </p>
<p>
The Activity API provides the same basic interface as the other Core Motion APIs except:    </p>
<ul class=" "><li class=" "> <p>
Use the <tt class=" ">queryActivity</tt> method to retrieve a log of activities within a time period.  Pass a dictionary with two key-value pairs as the first parameter.  Set the <tt class=" ">start</tt> property to a JavaScript Date object indicating the start time of the period and the <tt class=" ">end</tt> property to a JavaScript Date object indicating the end of the period.  Neither of these properties can be left undefined. Pass a callback to handle the query response as the second parameter.  Check the <tt class=" ">activities</tt> property, which returns an array of <tt class=" ">activity</tt> dictionaries, for the query results.    </p>
</li><li class=" "> <p>
The dictionary object passed to the callback only contains the <tt class=" ">activity</tt> property.  The dictionary does not contain the <tt class=" ">code</tt>, <tt class=" ">error</tt>, <tt class=" ">success</tt> or <tt class=" ">timestamp</tt> properties.    </p>
</li><li class=" "> <p>
The Activity API does not have a &quot;set interval&quot; method.    </p>
</li></ul> <p>
The Activity API uses an <tt class=" ">activity</tt> dictionary to report the motion state of the device.  The <tt class=" ">activity</tt> dictionary contains the following properties:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">automotive</tt>: indicates whether the device is in an automobile.    </p>
</li><li class=" "> <p>
<tt class=" ">running</tt>: indicates whether the device is on a running person.    </p>
</li><li class=" "> <p>
<tt class=" ">stationary</tt>: indicates whether the device is stationary.    </p>
</li><li class=" "> <p>
<tt class=" ">unknown</tt>: indicates whether the type of motion is unknown.    </p>
</li><li class=" "> <p>
<tt class=" ">walking</tt>: indicates whether the device is on a walking person.    </p>
</li><li class=" "> <p>
<tt class=" ">confidence</tt>: confidence in the assessment of the motion type reported as one of the following constants:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.MOTION_ACTIVITY_CONFIDENCE_LOW</tt> </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.MOTION_ACTIVITY_CONFIDENCE_MEDIUM</tt> </p>
</li><li class=" "> <p>
<tt class=" ">&lt;CoreMotion&gt;.MOTION_ACTIVITY_CONFIDENCE_HIGH</tt> </p>
</li></ul></li><li class=" "> <p>
<tt class=" ">startDate</tt>: The time at which the change in motion occurred.    </p>
</li></ul> <p>
The first five properties indicate a possible motion-related activity that can be logged.  Only one of these properties may be set to true.  If you passed a callback to the <tt class=" ">startActivity</tt> method, check the <tt class=" ">activity</tt> property for the current results.    </p>
<div class="section section-4 " id="38928815_CoreMotionModule-Example.1">
<h4 class="heading "><span>Example</span></h4>
<p>
The following Alloy application captures the activity log of the device and displays it as a list to the user.  The application checks the confidence level of the captured data and see if the activity changed.  The application adds the activity data to the collection, which updates the list in the application.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app/views/index.xml</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">&lt;Alloy&gt;</code></div>
<div class="line"><code class="plain">    &lt;Collection src=</code><code class="string">"activities"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;Window </code><code class="keyword">class</code><code class="plain">=</code><code class="string">"container"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">        &lt;ListView top=</code><code class="string">"25"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">            &lt;ListSection dataCollection=</code><code class="string">"activities"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">                &lt;ListItem title=</code><code class="string">"{activity}"</code></div>
<div class="line"><code class="plain">                    subtitle=</code><code class="string">"{timestamp}"</code></div>
<div class="line"><code class="plain">                    template=</code><code class="string">"Ti.UI.LIST_ITEM_TEMPLATE_SUBTITLE"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">            &lt;/ListSection&gt;</code></div>
<div class="line"><code class="plain">        &lt;/ListView&gt;</code></div>
<div class="line"><code class="plain">    &lt;/Window&gt;</code></div>
<div class="line"><code class="plain">&lt;/Alloy&gt;</code></div>
</div>
</div><div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app/controllers/index.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var activities = Alloy.Collections.activities;</code></div>
<div class="line"><code class="plain">var model = Backbone.Model.extend();</code></div>
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">var last_activity = </code><code class="string">"unknown"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">CoreMotion.startActivityUpdates(updateActivity);</code></div>
<div class="line"><code class="plain">function updateActivity(e) {</code></div>
<div class="line"><code class="plain">    var data = e.activity;</code></div>
<div class="line"><code class="plain">    var dict = {};</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// Only capture data if the confidence is medium or high</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (data.confidence != CoreMotion.MOTION_ACTIVITY_CONFIDENCE_LOW) {</code></div>
<div class="line"><code class="plain">        dict.timestamp = data.startDate;</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (data.automotive) {</code></div>
<div class="line"><code class="plain">            dict.activity = </code><code class="string">"automotive"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (data.running) {</code></div>
<div class="line"><code class="plain">            dict.activity = </code><code class="string">"running"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (data.stationary) {</code></div>
<div class="line"><code class="plain">            dict.activity = </code><code class="string">"stationary"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (data.walking) {</code></div>
<div class="line"><code class="plain">            dict.activity = </code><code class="string">"walking"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (dict.activity == last_activity) {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        } </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">            activities.add(</code><code class="keyword">new</code><code class="plain"> model(dict));</code></div>
<div class="line"><code class="plain">            last_activity = dict.activity;</code></div>
<div class="line"><code class="plain">        }    </code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">$.index.open();</code></div>
</div>
</div><div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app/models/activities.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">exports.definition = {</code></div>
<div class="line"><code class="plain">    config: {</code></div>
<div class="line"><code class="plain">        adapter: {</code></div>
<div class="line"><code class="plain">            type: </code><code class="string">"properties"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">            collection_name: </code><code class="string">"activities"</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}; </code></div>
</div>
</div> <p>
<img src="images/download/attachments/38928815/activity.png" alt="images/download/attachments/38928815/activity.png" class="confluence-embedded-image" />
</p>
</div>
</div>
<div class="section section-3 p1" id="38928815_CoreMotionModule-StepCounter">
<h3 class="heading p1"><span>Step Counter</span></h3>
<p>
The Step Counter API keeps track of how many steps a user takes with the device.  The Step Counter API provides the same basic interface as the other Core Motion APIs except:    </p>
<ul class=" "><li class=" "> <p>
The <tt class=" ">startStepCountingUpdates</tt> method requires an additional parameter.  Pass a dictionary with one key-value pair. Set the <tt class=" ">stepCounts</tt> property to a value greater than zero.  The Step Counter API starts counting steps from this value.  Pass an optional callback function as the second parameter.  Check the <tt class=" ">numberOfSteps</tt> property for the current results.    </p>
</li><li class=" "> <p>
Use the <tt class=" ">queryStepCount</tt> method to retrieve the number steps taken within a time period.  Pass a dictionary with two key-value pairs as the first parameter.  Set the <tt class=" ">start</tt> property to a JavaScript Date object indicating the start time of the period and the <tt class=" ">end</tt> property to a JavaScript Date object indicating the end of the period.  Neither of these properties can be left undefined. Pass a callback to handle the query response as the second parameter.  Check the <tt class=" ">numberOfSteps</tt> property for the query results.    </p>
</li><li class=" "> <p>
The Step Counter API does not have a &quot;set interval&quot; method.    </p>
</li></ul> <div class="section section-4 " id="38928815_CoreMotionModule-Example.2">
<h4 class="heading "><span>Example</span></h4>
<p>
The sample code below uses the Step Counter API to measure the number of steps a user takes.  The device displays the measurement on screen.  The user presses the button to retrieve the number of steps taken within the last minute.  The application calls the <tt class=" ">queryStepCount</tt> method to retrieve the number of steps taken within the last minute.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="plain">var win = Ti.UI.createWindow({backgroundColor: </code><code class="string">'white'</code><code class="plain">, layout: </code><code class="string">'vertical'</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var step_label = Ti.UI.createLabel({text: </code><code class="string">"0"</code><code class="plain">, top: </code><code class="value">25</code><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(step_label);</code></div>
<div class="line"><code class="plain">var step_history_label = Ti.UI.createLabel({text: </code><code class="string">"Press the button for step history."</code><code class="plain">, top: </code><code class="value">25</code><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(step_history_label);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isStepCountingAvailable()) {</code></div>
<div class="line"><code class="plain">    CoreMotion.startStepCountingUpdates({stepCounts: </code><code class="value">1</code><code class="plain">}, function(e){</code></div>
<div class="line"><code class="plain">        step_label.text = e.numberOfSteps;</code></div>
<div class="line"><code class="plain">    });</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">var button = Ti.UI.createButton({title: </code><code class="string">"Last Minute"</code><code class="plain">, top: </code><code class="value">25</code><code class="plain">});</code></div>
<div class="line"><code class="plain">button.addEventListener(</code><code class="string">'click'</code><code class="plain">, function(e){</code></div>
<div class="line"><code class="plain">    CoreMotion.queryStepCount({</code></div>
<div class="line"><code class="plain">        start: </code><code class="keyword">new</code><code class="plain"> Date(</code><code class="keyword">new</code><code class="plain"> Date().getTime() - </code><code class="value">60</code><code class="plain">*</code><code class="value">1000</code><code class="plain">), </code></div>
<div class="line"><code class="plain">        end: </code><code class="keyword">new</code><code class="plain"> Date()</code></div>
<div class="line"><code class="plain">    }, function (e) {</code></div>
<div class="line"><code class="plain">            step_history_label.text = </code><code class="string">"You walked "</code><code class="plain"> + e.numberOfSteps + </code><code class="string">" steps in the last minute."</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    );</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(button);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> </div>
</div>
<div class="section section-3 " id="38928815_CoreMotionModule-Accelerometer">
<h3 class="heading "><span>Accelerometer</span></h3>
<p>
The accelerometer measures the instantaneous g-force acceleration acting on the device along each spatial axis.    </p>
<p>
The Accelerometer API uses a <tt class=" ">acceleration</tt> dictionary to report the measurements of the device.  The dictionary contains three properties: <tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the acceleration values in G's along the X-, Y- and Z-axes, respectively.  If you passed a callback to the <tt class=" ">setAccelerometerUpdates</tt> method, check the <tt class=" ">acceleration</tt> property for these values.    </p>
<p>
If you want to measure acceleration force the user applies to the phone, use the Device Motion API.    </p>
<div class="section section-4 " id="38928815_CoreMotionModule-Example.3">
<h4 class="heading "><span>Example</span></h4>
<p>
The sample code below use the Accelerometer API to send acceleration data at 1 s intervals.  The device displays the data on screen.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isAccelerometerAvailable()) {</code></div>
<div class="line"><code class="plain">    CoreMotion.setAccelerometerUpdateInterval(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    CoreMotion.startAccelerometerUpdates(updateAccelData);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">	alert(</code><code class="string">"Device does not have an accelerometer."</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="comments">// GUI to display measurements</code></div>
<div class="line"><code class="plain">var win = Ti.UI.createWindow({backgroundColor: </code><code class="string">'white'</code><code class="plain">, layout: </code><code class="string">'vertical'</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var progress_bar_args = {</code></div>
<div class="line"><code class="plain">    max: </code><code class="value">1</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    min: </code><code class="value">0</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    value: </code><code class="value">0</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    width: </code><code class="value">200</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    top: </code><code class="value">50</code><code class="plain"> </code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"><code class="plain">var accelX = Ti.UI.createProgressBar(progress_bar_args);</code></div>
<div class="line"><code class="plain">var accelY = Ti.UI.createProgressBar(progress_bar_args);</code></div>
<div class="line"><code class="plain">var accelZ = Ti.UI.createProgressBar(progress_bar_args);</code></div>
<div class="line"><code class="plain">win.add(accelX);</code></div>
<div class="line"><code class="plain">win.add(accelY);</code></div>
<div class="line"><code class="plain">win.add(accelZ);</code></div>
<div class="line"><code class="plain">accelX.show();</code></div>
<div class="line"><code class="plain">accelY.show();</code></div>
<div class="line"><code class="plain">accelZ.show();</code></div>
<div class="line"><code class="plain">function updateAccelData (e) {</code></div>
<div class="line"><code class="plain">    data = e.acceleration;</code></div>
<div class="line"><code class="plain">    accelX.message = </code><code class="string">"X: "</code><code class="plain"> + data.x;</code></div>
<div class="line"><code class="plain">    accelX.value = Math.abs(data.x);</code></div>
<div class="line"><code class="plain">    accelY.message = </code><code class="string">"Y: "</code><code class="plain"> + data.y;</code></div>
<div class="line"><code class="plain">    accelY.value = Math.abs(data.y);</code></div>
<div class="line"><code class="plain">    accelZ.message = </code><code class="string">"Z: "</code><code class="plain"> + data.z;</code></div>
<div class="line"><code class="plain">    accelZ.value = Math.abs(data.z);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> </div>
</div>
<div class="section section-3 " id="38928815_CoreMotionModule-Gyroscope">
<h3 class="heading "><span>Gyroscope</span></h3>
<p>
The gyroscope measures the instantaneous rotational rate of the device along each spatial axis.    </p>
<p>
The Gyroscope API uses a <tt class=" ">rotationRate</tt> dictionary to report the measurements of the device.  The dictionary contains three properties: <tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the rotational rates in radian along the X-, Y- and Z-axes, respectively.  If you passed a callback to the <tt class=" ">setGyroUpdates</tt> method, check the <tt class=" ">rotationRate</tt> property for these values.    </p>
<div class="section section-4 " id="38928815_CoreMotionModule-Example.4">
<h4 class="heading "><span>Example</span></h4>
<p>
The sample code below use the Gyroscope API to send rotation rate data at 1 s intervals.  The device displays the data on screen.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isGyroAvailable()) {</code></div>
<div class="line"><code class="plain">    CoreMotion.setGyroUpdateInterval(</code><code class="value">1000</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    CoreMotion.startGyroUpdates(updateGyroData);</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">	alert(</code><code class="string">"Device does not have an gyroscope."</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="comments">// GUI to display measurements</code></div>
<div class="line"><code class="plain">var win = Ti.UI.createWindow({backgroundColor: </code><code class="string">'white'</code><code class="plain">, layout: </code><code class="string">'vertical'</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var progress_bar_args = {</code></div>
<div class="line"><code class="plain">    max: </code><code class="value">1</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    min: </code><code class="value">0</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    value: </code><code class="value">0</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    width: </code><code class="value">200</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    top: </code><code class="value">50</code><code class="plain"> </code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"><code class="plain">var gyroX = Ti.UI.createProgressBar(progress_bar_args);</code></div>
<div class="line"><code class="plain">var gyroY = Ti.UI.createProgressBar(progress_bar_args);</code></div>
<div class="line"><code class="plain">var gyroZ = Ti.UI.createProgressBar(progress_bar_args);</code></div>
<div class="line"><code class="plain">win.add(gyroX);</code></div>
<div class="line"><code class="plain">win.add(gyroY);</code></div>
<div class="line"><code class="plain">win.add(gyroZ);</code></div>
<div class="line"><code class="plain">gyroX.show();</code></div>
<div class="line"><code class="plain">gyroY.show();</code></div>
<div class="line"><code class="plain">gyroZ.show();</code></div>
<div class="line"><code class="plain">function updateGyroData (e) {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.success) {</code></div>
<div class="line"><code class="plain">	    data = e.rotationRate;</code></div>
<div class="line"><code class="plain">	    gyroX.message = </code><code class="string">"X: "</code><code class="plain"> + data.x;</code></div>
<div class="line"><code class="plain">	    gyroX.value = Math.abs(data.x);</code></div>
<div class="line"><code class="plain">	    gyroY.message = </code><code class="string">"Y: "</code><code class="plain"> + data.y;</code></div>
<div class="line"><code class="plain">	    gyroY.value = Math.abs(data.y);</code></div>
<div class="line"><code class="plain">	    gyroZ.message = </code><code class="string">"Z: "</code><code class="plain"> + data.z;</code></div>
<div class="line"><code class="plain">	    gyroZ.value = Math.abs(data.z);</code></div>
<div class="line"><code class="plain">	} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">if</code><code class="plain"> (e.error) {</code></div>
<div class="line"><code class="plain">			Ti.API.error(e.error);</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> <p>
</p>
</div>
</div>
<div class="section section-3 " id="38928815_CoreMotionModule-Magnetometer">
<h3 class="heading "><span>Magnetometer</span></h3>
<p>
The magnetometer measures the strength and direction of magnetic fields along each spatial axis.     </p>
<p>
The Magnetometer API uses a <tt class=" ">magneticField</tt> dictionary to report the measurements of the device.  The dictionary contains three properties: <tt class=" ">x</tt>, <tt class=" ">y</tt> and <tt class=" ">z</tt>, which provides the magnetic field values in microteslas along the X-, Y- and Z-axes, respectively.  If you passed a callback to the <tt class=" ">setMagnetometerUpdates</tt> method, check the <tt class=" ">magnetField</tt> property for these values.    </p>
<div class="section section-4 " id="38928815_CoreMotionModule-Example.5">
<h4 class="heading "><span>Example</span></h4>
<p>
The sample code below uses the Magnetometer API to take magnetic field measurements.  The user must manually press the button to update the data on the display.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var CoreMotion = require(</code><code class="string">'ti.coremotion'</code><code class="plain">);</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (CoreMotion.isMagnetometerAvailable()) {</code></div>
<div class="line"><code class="plain">    CoreMotion.startMagnetometerUpdates();</code></div>
<div class="line"><code class="plain">} </code><code class="keyword">else</code><code class="plain"> {</code></div>
<div class="line"><code class="plain">    alert(</code><code class="string">"Device does not have a magnetometer."</code><code class="plain">);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">var win = Ti.UI.createWindow({backgroundColor: </code><code class="string">'white'</code><code class="plain">, layout: </code><code class="string">'vertical'</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var xMag = Ti.UI.createLabel({text: </code><code class="string">'X: 0'</code><code class="plain">, top: </code><code class="value">50</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var yMag = Ti.UI.createLabel({text: </code><code class="string">'Y: 0'</code><code class="plain">, top: </code><code class="value">50</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var zMag = Ti.UI.createLabel({text: </code><code class="string">'Z: 0'</code><code class="plain">, top: </code><code class="value">50</code><code class="plain">});</code></div>
<div class="line"><code class="plain">var totalMag = Ti.UI.createLabel({text: </code><code class="string">'TOTAL: 0'</code><code class="plain">, top: </code><code class="value">50</code><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(xMag);</code></div>
<div class="line"><code class="plain">win.add(yMag);</code></div>
<div class="line"><code class="plain">win.add(zMag);</code></div>
<div class="line"><code class="plain">win.add(totalMag);</code></div>
<div class="line"><code class="plain">var button = Ti.UI.createButton({title: </code><code class="string">"Update Values"</code><code class="plain">, top: </code><code class="value">25</code><code class="plain">});</code></div>
<div class="line"><code class="plain">button.addEventListener(</code><code class="string">'click'</code><code class="plain">, function(e){</code></div>
<div class="line"><code class="plain">    updateMagnetometerData(CoreMotion.getMagnetometerData());</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(button);</code></div>
<div class="line"><code class="plain">function updateMagnetometerData (e) {</code></div>
<div class="line"><code class="plain">    data = e.magneticField;</code></div>
<div class="line"><code class="plain">    xMag.text = </code><code class="string">"X: "</code><code class="plain"> + data.x;</code></div>
<div class="line"><code class="plain">    yMag.text = </code><code class="string">"Y: "</code><code class="plain"> + data.y;</code></div>
<div class="line"><code class="plain">    zMag.text = </code><code class="string">"Z: "</code><code class="plain"> + data.z;</code></div>
<div class="line"><code class="plain">    totalMag.text = </code><code class="string">"Total: "</code><code class="plain"> + Math.sqrt(data.x*data.x + data.y*data.y + data.z*data.z);</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> </div>
</div>
</div>
</div>
<div class="footer">
            Created with <a href="http://k15t.com/display/web/Scroll-Wiki-EclipseHelp-Exporter-for-Confluence" target="_blank">Scroll EclipseHelp Exporter for Confluence</a>.
        </div>
</div>
</body>
</html>
