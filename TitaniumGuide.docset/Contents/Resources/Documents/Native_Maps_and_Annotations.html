<!-- single file version -->
<!DOCTYPE html>
<html>
<head>
  <link href="css/github.css" rel="stylesheet" type="text/css">
  <link href="resources/css/common.css" rel="stylesheet" type="text/css">
  <meta charset="utf-8" />
</head>
<body>

<div class="container">
<div class="header"></div>
<div id="29004916" class="content">
<h1>Native Maps and Annotations</h1>
<p>
</p>
<div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
<p>
For new Android applications, use <a class="external-link external-link" href="/platform/latest/#!/api/Modules.Map">ti.map add-on module</a> to add native maps support for your application. Google is no longer issuing Google Maps API v1 keys. If you have an application that still uses the old keys, you can either transition to the new module or continue using the built-in Titanium.Maps module. For more information about the add-on module, refer to <a class="document-link " href="#!/guide/Google_Maps_v2_for_Android" google_maps_v2_for_android.html="Google_Maps_v2_for_Android.html">Google Maps v2 for Android</a>.    </p>
<p>
Since 3.2.0 on the iOS platform, use the <a class="external-link external-link" href="/platform/latest/#!/api/Modules.Map">ti.map add-on module</a>. The native map functionality for iOS has been removed from the <tt class=" ">Titanium.Map</tt> namespace. For more information about the add-on module, refer to <a class="document-link " href="#!/guide/iOS_Map_Kit" ios_map_kit.html="iOS_Map_Kit.html">iOS Map Kit</a>.    </p>
</div>
<div class="section section-2 " id="29004916_NativeMapsandAnnotations-Objective">
<h2 class="heading "><span>Objective</span></h2>
<p>
In this chapter, you&apos;ll learn how to use Titanium&apos;s Map API to visually represent location data via maps, routes, and annotations. In addition you&apos;ll learn best practices with respect to using the API. The context of location is one of the most powerful features of mobile apps, and soon you&apos;ll be equipped to visualize that data using native UI components through Titanium.    </p>
</div>
<div class="section section-2 " id="29004916_NativeMapsandAnnotations-Content">
<h2 class="heading "><span>Content</span></h2>
<ul class=" "><li class=" "> <p>
Displaying a MapView    </p>
</li><li class=" "> <p>
Handling MapView events    </p>
</li><li class=" "> <p>
Annotations    </p>
</li><li class=" "> <p>
Routes    </p>
</li><li class=" "> <p>
Android Maps API Key for Distribution    </p>
</li></ul> <div class="section section-3 " id="29004916_NativeMapsandAnnotations-DisplayingaMapView">
<h3 class="heading "><span>Displaying a MapView</span></h3>
<p>
The <tt class=" ">MapView</tt> is the core UI component of the <tt class=" ">Ti.Map</tt> module. It allows Titanium to make use of a mobile device&apos;s underlying native maps to view geographic data and add annotations and routes. As it is a native UI component, users will also have access to features like scrolling and multi-touch zoom. In its most basic form, the <tt class=" ">MapView</tt> can simply display a basic map given a geographic position via latitude and longitude.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win = Ti.UI.createWindow();</code></div>
<div class="line"><code class="plain">var mapview = Titanium.Map.createView({</code></div>
<div class="line"><code class="plain">    mapType: Titanium.Map.STANDARD_TYPE,</code></div>
<div class="line"><code class="plain">    region: {latitude:</code><code class="value">37.389569</code><code class="plain">, longitude:-</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">            latitudeDelta:</code><code class="value">0.1</code><code class="plain">, longitudeDelta:</code><code class="value">0.1</code><code class="plain">},</code></div>
<div class="line"><code class="plain">    animate:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    regionFit:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    userLocation:</code><code class="keyword">false</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(mapview);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> <p>
<img src="images/download/attachments/29004916/iphone_map.png" alt="images/download/attachments/29004916/iphone_map.png" class="confluence-embedded-image confluence-content-image-border">
<img src="images/download/attachments/29004916/android_map.png" alt="images/download/attachments/29004916/android_map.png" class="confluence-embedded-image confluence-content-image-border">
</p>
<p>
As seen above, those few lines of code generate native maps on both iOS and Android, respectively. Now that we have a basic map, let&apos;s discuss some of the properties of the <tt class=" ">Ti.Map.MapView</tt> in order to see how it can be manipulated.    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">mapType</tt> - Indicates what type of map should be displayed. Below we see the <tt class=" ">Ti.Map.STANDARD_TYPE</tt>, <tt class=" ">Ti.Map.SATELLITE_TYPE</tt>, and <tt class=" ">Ti.Map.HYBRID_TYPE</tt> respectively.<br> <img src="images/download/attachments/29004916/stan.png" alt="images/download/attachments/29004916/stan.png" class="confluence-embedded-image confluence-content-image-border">
<img src="images/download/attachments/29004916/sate.png" alt="images/download/attachments/29004916/sate.png" class="confluence-embedded-image confluence-content-image-border">
<img src="images/download/attachments/29004916/hybr.png" alt="images/download/attachments/29004916/hybr.png" class="confluence-embedded-image confluence-content-image-border">
</p>
</li><li class=" "> <p>
<tt class=" ">region</tt> - This is an object that contains the 4 properties defining the visible area of the <tt class=" ">MapView</tt>. Below we can see how the same latitude and longitude of a <tt class=" ">region</tt> can be represented with a different level of zoom via the <tt class=" ">latitudeDelta</tt> and <tt class=" ">longitudeDelta</tt> properties.<br> <img src="images/download/attachments/29004916/stan.png" alt="images/download/attachments/29004916/stan.png" class="confluence-embedded-image confluence-content-image-border">
<tt class=" "> </tt> <img src="images/download/attachments/29004916/delta.png" alt="images/download/attachments/29004916/delta.png" class="confluence-embedded-image confluence-content-image-border">
    ** <tt class=" ">latitude</tt>- The latitude of your map&apos;s target region    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">longitude</tt> - The longitude of your map&apos;s target region    </p>
</li><li class=" "> <p>
<tt class=" ">latitudeDelta</tt> - The measure of latitude north and south from your target regions&apos;s latitude that will be visible in the <tt class=" ">MapView</tt>. The smaller the delta value, the closer the zoom on your map.    </p>
</li><li class=" "> <p>
<tt class=" ">longitudeDelta</tt> - The measure of longitude east and west from your target regions&apos;s longitude that will be visible in the <tt class=" ">MapView</tt> </p>
</li></ul></li><li class=" "> <p>
<tt class=" ">animate</tt> - A boolean that indicates whether or not map actions, like opening and adding annotations, should be animated    </p>
</li><li class=" "> <p>
<tt class=" ">regionFit</tt> - A boolean that indicates if the map should attempt to fit the <tt class=" ">MapView</tt> into the region in the visible view    </p>
</li><li class=" "> <p>
<tt class=" ">userLocation</tt> - A boolean that indicates if the map should show the user&apos;s current device location as a pin on the map    </p>
</li></ul> <p>
</p>
<div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
<div class="title">Android MapView Limitation</div>
<p>
On Android, only a <strong class=" ">single</strong> map view is supported per application. Adding a second map view to an application results in an exception being thrown.    </p>
</div>
<p>
There are 2 more components that add a significant amount of functionality to your <tt class=" ">mapViews</tt>. They are <tt class=" ">annotations</tt> and <tt class=" ">routes</tt>. They allow us to add places of interest to our maps as well as plot paths between them. We&apos;ll address each in the following sections. But let&apos;s first discuss how we can handle events on our basic <tt class=" ">MapView</tt>.    </p>
</div>
<div class="section section-3 " id="29004916_NativeMapsandAnnotations-HandlingMapViewEvents">
<h3 class="heading "><span>Handling MapView Events</span></h3>
<p>
In addition to the typical touch interaction events that all views have, <tt class=" ">MapViews</tt> have a couple more that give you more refined control. In many cases, we want to know exactly how a user&apos;s interaction with our initial map has changed its appearance. Also, having events that let us know when the map is loading and completed allow us to make our location based apps more responsive.    </p>
<p>
Here&apos;s the 3 events specific to <tt class=" ">MapView</tt> that give you that additional control, and one additional event for handling mapping errors:    </p>
<ul class=" "><li class=" "> <p>
complete - This event is fired when the <tt class=" ">MapView</tt> has completed querying and rendering    </p>
</li><li class=" "> <p>
loading - This event is fired when the <tt class=" ">MapView</tt> has started querying for new data, as well as rendering the new map. This is typically the result of the user changing the visible region of the map.    </p>
</li><li class=" "> <p>
regionChanged - The event is fired when the visible region of our <tt class=" ">MapView</tt>has changed. This can occur from programmatic changes, or from user interaction with the map. The new region data is returned in the following structure:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    latitude: </code><code class="value">37.389569</code></div>
<div class="line"><code class="plain">    latitudeDelta: </code><code class="value">0.1</code></div>
<div class="line"><code class="plain">    longitude: -</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    longitudeDelta: </code><code class="value">1</code></div>
<div class="line"><code class="plain">    source: </code><code class="string">&quot;[object TiMapView]&quot;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    type: </code><code class="string">&apos;regionChanged&apos;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div></li><li class=" "> <p>
error - This event let&apos;s us know when ever there is an error encountered by the underlying native maps. Often times these errors are not critical, but need to be handled in order to preserve a quality user experience.    </p>
</li></ul> <p>
As mentioned, the most common way to trigger the above events is through user interaction via scrolling and zooming. Let&apos;s change the <tt class=" ">MapView</tt> example code to handle all of the aforementioned events.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win = Ti.UI.createWindow();</code></div>
<div class="line"><code class="plain">var mapview = Titanium.Map.createView({</code></div>
<div class="line"><code class="plain">    mapType: Titanium.Map.STANDARD_TYPE,</code></div>
<div class="line"><code class="plain">    region: {latitude:</code><code class="value">37.389569</code><code class="plain">, longitude:-</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">            latitudeDelta:</code><code class="value">0.1</code><code class="plain">, longitudeDelta:</code><code class="value">0.1</code><code class="plain">},</code></div>
<div class="line"><code class="plain">    animate:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    regionFit:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    userLocation:</code><code class="keyword">false</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">mapview.addEventListener(</code><code class="string">&apos;complete&apos;</code><code class="plain">, function(e) {</code></div>
<div class="line"><code class="plain">	Ti.API.info(</code><code class="string">&apos;complete&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	Ti.API.info(e);</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">mapview.addEventListener(</code><code class="string">&apos;error&apos;</code><code class="plain">, function(e) {</code></div>
<div class="line"><code class="plain">	Ti.API.info(</code><code class="string">&apos;error&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	Ti.API.info(e);</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">mapview.addEventListener(</code><code class="string">&apos;loading&apos;</code><code class="plain">, function(e) {</code></div>
<div class="line"><code class="plain">	Ti.API.info(</code><code class="string">&apos;loading&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	Ti.API.info(e);</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">mapview.addEventListener(</code><code class="string">&apos;regionChanged&apos;</code><code class="plain">, function(e) {</code></div>
<div class="line"><code class="plain">	Ti.API.info(</code><code class="string">&apos;regionChanged&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	Ti.API.info(e);</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(mapview);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> <p>
Now we&apos;ll run the example again, this time zooming the map out after it renders.    </p>
<p>
<img src="images/download/attachments/29004916/zoom_full.png" alt="images/download/attachments/29004916/zoom_full.png" class="confluence-embedded-image">
</p>
<p>
And here is the event console output from this interaction.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">[INFO] loading</code></div>
<div class="line"><code class="plain">[INFO] {</code></div>
<div class="line"><code class="plain">    source = </code><code class="string">&quot;[object TiMapView]&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    type = loading;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">[INFO] complete</code></div>
<div class="line"><code class="plain">[INFO] {</code></div>
<div class="line"><code class="plain">    source = </code><code class="string">&quot;[object TiMapView]&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    type = complete;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">[INFO] regionChanged</code></div>
<div class="line"><code class="plain">[INFO] {</code></div>
<div class="line"><code class="plain">    latitude = </code><code class="string">&quot;37.35867258291223&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    latitudeDelta = </code><code class="string">&quot;1.883241287989044&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    longitude = </code><code class="string">&quot;-122.049009169728&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    longitudeDelta = </code><code class="string">&quot;1.648237229196269&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    source = </code><code class="string">&quot;[object TiMapView]&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    type = regionChanged;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
Notice the order of events. <tt class=" ">loading</tt> is first, signifying that new map data needs to be queried. <tt class=" ">complete</tt> follows, letting us know that the preceding map query has completed. Finally, we get the <tt class=" ">regionChanged</tt> event which gives us the new coordinates and deltas for the visible map region. This is the typical flow for all map interactions.    </p>
<p>
So now that we can display a basic <tt class=" ">MapView</tt> and handle user interactions with it, let&apos;s take a look at how we can use annotations and routes to further extend the <tt class=" ">MapView</tt> functionality.    </p>
</div>
<div class="section section-3 " id="29004916_NativeMapsandAnnotations-Annotations">
<h3 class="heading "><span>Annotations</span></h3>
<p>
Annotations, created with the <tt class=" ">Ti.Map.createAnnotation()</tt> function, allow us to mark places of interest on our <tt class=" ">MapViews</tt> with &quot;pins&quot;, images, and text. They can be added when a <tt class=" ">MapView</tt> is created via the <tt class=" ">annotations</tt> array property, or anytime afterwards with the <tt class=" ">Ti.Map.MapView.addAnnotation()</tt> function. Users can even interact with them to learn more about annotated locations.    </p>
<p>
Adding an annotation to a <tt class=" ">MapView</tt> is simple. Let&apos;s modify the basic <tt class=" ">MapView</tt> example to see how we can add the Appcelerator headquarters, and a few other locations, as annotations. To make things more interesting, we&apos;ll use a number of the styling properties available to annotations through the Titanium API.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win = Ti.UI.createWindow();</code></div>
<div class="line"><code class="plain">var annotations = [</code></div>
<div class="line"><code class="plain">	Ti.Map.createAnnotation({</code></div>
<div class="line"><code class="plain">		latitude: </code><code class="value">37.389569</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		longitude: -</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		title: </code><code class="string">&apos;Appcelerator HQ&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		subtitle: </code><code class="string">&apos;Mountain View, CA&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		animate: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		pincolor: Ti.Map.ANNOTATION_GREEN,</code></div>
<div class="line"><code class="plain">		leftButton: </code><code class="string">&apos;appcelerator.gif&apos;</code></div>
<div class="line"><code class="plain">	}),</code></div>
<div class="line"><code class="plain">	Ti.Map.createAnnotation({</code></div>
<div class="line"><code class="plain">		latitude: </code><code class="value">37.331689</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		longitude: -</code><code class="value">122.030731</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		title: </code><code class="string">&apos;Apple HQ&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		subtitle: </code><code class="string">&apos;Cupertino, CA&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		animate: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		pincolor: Ti.Map.ANNOTATION_RED,</code></div>
<div class="line"><code class="plain">		rightButton: </code><code class="string">&apos;apple.png&apos;</code></div>
<div class="line"><code class="plain">	}),</code></div>
<div class="line"><code class="plain">	Ti.Map.createAnnotation({</code></div>
<div class="line"><code class="plain">		latitude: </code><code class="value">37.422502</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		longitude: -</code><code class="value">122.0855498</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		title: </code><code class="string">&apos;Google HQ&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		subtitle: </code><code class="string">&apos;Mountain View, CA&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		animate: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		image: </code><code class="string">&apos;google.png&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		leftView: Ti.UI.createButton({</code></div>
<div class="line"><code class="plain">			title: </code><code class="string">&apos;leftView&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			height: </code><code class="value">32</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			width: </code><code class="value">70</code></div>
<div class="line"><code class="plain">		}),</code></div>
<div class="line"><code class="plain">		rightView: Ti.UI.createLabel({</code></div>
<div class="line"><code class="plain">			text: </code><code class="string">&apos;rightView&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			color: </code><code class="string">&apos;#fff&apos;</code></div>
<div class="line"><code class="plain">		})</code></div>
<div class="line"><code class="plain">	})</code></div>
<div class="line"><code class="plain">];</code></div>
<div class="line"><code class="plain">var mapview = Titanium.Map.createView({</code></div>
<div class="line"><code class="plain">    mapType: Titanium.Map.STANDARD_TYPE,</code></div>
<div class="line"><code class="plain">    region: {</code></div>
<div class="line"><code class="plain">    	latitude:</code><code class="value">37.389569</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    	longitude:-</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        latitudeDelta:.</code><code class="value">05</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        longitudeDelta:.</code><code class="value">05</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    animate:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    regionFit:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    userLocation:</code><code class="keyword">false</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    annotations: annotations</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(mapview);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> <p>
We just created an array full of annotations, then passed that array to the <tt class=" ">MapView</tt> for use when it was created. Even if we had only one annotation, we still need to pass it to the <tt class=" ">MapView</tt> as an entry in an array. With the array of annotations constructed, we are ready to display them in a <tt class=" ">MapView</tt>. Here&apos;s what it looks like on Android and iPhone, respectively.    </p>
<p>
<img src="images/download/attachments/29004916/gmap.png" alt="images/download/attachments/29004916/gmap.png" class="confluence-embedded-image confluence-content-image-border">
<img src="images/download/attachments/29004916/imap.png" alt="images/download/attachments/29004916/imap.png" class="confluence-embedded-image confluence-content-image-border">
</p>
<p>
As we can see, there&apos;s many <tt class=" ">Annotation</tt> properties available for styling and interaction. We can add text, animations, colors, and even more UI components through use of these properties. Let&apos;s take a look at each of the properties used in this example.    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">animate</tt> - A boolean variable that indicates whether or not the annotation should be animated when it is added to the <tt class=" ">MapView</tt> </p>
</li><li class=" "> <p>
<tt class=" ">image</tt> - The URL to an image to be used in place of the default pin image    </p>
</li><li class=" "> <p>
<tt class=" ">leftButton</tt> - A button that will appear on the left side of your annotation when clicked. This property must have a value equal to the URL of an image, or to a <tt class=" ">Ti.UI.iPhone.SystemButtonStyle</tt> constant.    </p>
</li><li class=" "> <p>
<tt class=" ">leftView</tt> - A Titanium View object that will appear on the left side of your annotation when clicked. This property can be a single view like a <tt class=" ">Ti.UI.Button</tt> or <tt class=" ">Ti.UI.Label</tt>, or it can be a hierarchy of views.    </p>
</li><li class=" "> <p>
<tt class=" ">pincolor</tt>- The color of the default pin representing an annotation. It can have the following values:    </p>
<ul class=" "><li class=" "> <p>
<tt class=" ">Ti.Map.ANNOTATION_GREEN</tt> </p>
</li><li class=" "> <p>
<tt class=" ">Ti.Map.ANNOTATION_PURPLE</tt> </p>
</li><li class=" "> <p>
<tt class=" ">Ti.Map.ANNOTATION_RED</tt> </p>
</li></ul></li><li class=" "> <p>
<tt class=" ">rightButton</tt> - A button that will appear on the right side of your annotation when clicked. This property must have a value equal to the URL of an image, or to a <tt class=" ">Ti.UI.iPhone.SystemButtonStyle</tt> constant.    </p>
</li><li class=" "> <p>
<tt class=" ">rightView</tt> - A Titanium View object that will appear on the right side of your annotation when clicked. This property can be a single view like a <tt class=" ">Ti.UI.Button</tt> or <tt class=" ">Ti.UI.Label</tt>, or it can be a hierarchy of views.    </p>
</li><li class=" "> <p>
<tt class=" ">subtitle</tt> - The subtitle text that appears on your annotation when clicked    </p>
</li><li class=" "> <p>
<tt class=" ">title</tt> - The main title text that appears on your annotation when clicked    </p>
</li></ul> <p>
So now you know how to create a <tt class=" ">MapView</tt>, handle changes in its region, and add locations of interest via <tt class=" ">Annotations</tt>. There&apos;s one more bit of functionality: <tt class=" ">routes</tt>. In the next section we&apos;ll discuss <tt class=" ">routes</tt>, a feature that allows us to create paths between locations on a <tt class=" ">MapView</tt>.    </p>
</div>
<div class="section section-3 " id="29004916_NativeMapsandAnnotations-Routes">
<h3 class="heading "><span>Routes</span></h3>
<p>
Routes allow us to draw paths between locations on a <tt class=" ">MapView</tt>. These paths can be driving directions, bike paths, or any other reason you have to connect point A to point B.    </p>
<div class="confbox admonition admonition-note aui-message warning shadowed information-macro">
<p>
Prior to Titanium Mobile Release 2.1, routes were supported on iOS only.    </p>
</div>
<p>
<tt class=" ">Routes</tt> are added to <tt class=" ">MapViews</tt> via the <tt class=" ">Ti.Map.MapView.addRoute()</tt> function. To use the <tt class=" ">addRoute()</tt> function, we pass it a properly structured <tt class=" ">route</tt> object that will then be represented on the <tt class=" ">MapView</tt>. The <tt class=" ">route</tt> object should take the following form:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    name: </code><code class="string">&apos;route name&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    color: </code><code class="string">&apos;#f00&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    width: </code><code class="value">4</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    points: [</code></div>
<div class="line"><code class="plain">        {latitude:</code><code class="value">50</code><code class="plain">, longitude:</code><code class="value">50</code><code class="plain">},</code></div>
<div class="line"><code class="plain">        ...</code></div>
<div class="line"><code class="plain">    ]</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
While the <tt class=" ">name</tt>, <tt class=" ">color</tt>, and <tt class=" ">width</tt> fields are self-explanatory, the <tt class=" ">points</tt> array could use some additional detail. <tt class=" ">points</tt> holds the array of latitude and longitude coordinates that represent each point in our <tt class=" ">route</tt>. As geometry dictates, you must have at least 2 points to draw a line, or route in this case. Limitations on the number of points you can use in a route are platform specific and are not governed by the Titanium API.    </p>
<p>
So let&apos;s go back to our <tt class=" ">MapView</tt> example one more time and add a route to it. We&apos;ll create a route that connects the 3 locations we&apos;ve already annotated. The route will go from north to south, connecting each location with a red, 4 pixel wide line.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win = Ti.UI.createWindow();</code></div>
<div class="line"><code class="plain">var annotations = [</code></div>
<div class="line"><code class="plain">	Ti.Map.createAnnotation({</code></div>
<div class="line"><code class="plain">		latitude: </code><code class="value">37.389569</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		longitude: -</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		title: </code><code class="string">&apos;Appcelerator HQ&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		subtitle: </code><code class="string">&apos;Mountain View, CA&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		animate: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		pincolor: Ti.Map.ANNOTATION_GREEN,</code></div>
<div class="line"><code class="plain">		leftButton: </code><code class="string">&apos;appcelerator.gif&apos;</code></div>
<div class="line"><code class="plain">	}),</code></div>
<div class="line"><code class="plain">	Ti.Map.createAnnotation({</code></div>
<div class="line"><code class="plain">		latitude: </code><code class="value">37.331689</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		longitude: -</code><code class="value">122.030731</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		title: </code><code class="string">&apos;Apple HQ&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		subtitle: </code><code class="string">&apos;Cupertino, CA&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		animate: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		pincolor: Ti.Map.ANNOTATION_RED,</code></div>
<div class="line"><code class="plain">		rightButton: </code><code class="string">&apos;apple.png&apos;</code></div>
<div class="line"><code class="plain">	}),</code></div>
<div class="line"><code class="plain">	Ti.Map.createAnnotation({</code></div>
<div class="line"><code class="plain">		latitude: </code><code class="value">37.422502</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		longitude: -</code><code class="value">122.0855498</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		title: </code><code class="string">&apos;Google HQ&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		subtitle: </code><code class="string">&apos;Mountain View, CA&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		animate: </code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		image: </code><code class="string">&apos;google.png&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		leftView: Ti.UI.createButton({</code></div>
<div class="line"><code class="plain">			title: </code><code class="string">&apos;leftView&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			height: </code><code class="value">32</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			width: </code><code class="value">70</code></div>
<div class="line"><code class="plain">		}),</code></div>
<div class="line"><code class="plain">		rightView: Ti.UI.createLabel({</code></div>
<div class="line"><code class="plain">			text: </code><code class="string">&apos;rightView&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			color: </code><code class="string">&apos;#fff&apos;</code></div>
<div class="line"><code class="plain">		})</code></div>
<div class="line"><code class="plain">	})</code></div>
<div class="line"><code class="plain">];</code></div>
<div class="line"><code class="plain">var mapview = Titanium.Map.createView({</code></div>
<div class="line"><code class="plain">    mapType: Titanium.Map.STANDARD_TYPE,</code></div>
<div class="line"><code class="plain">    region: {</code></div>
<div class="line"><code class="plain">    	latitude:</code><code class="value">37.389569</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    	longitude:-</code><code class="value">122.050212</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        latitudeDelta:.</code><code class="value">05</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        longitudeDelta:.</code><code class="value">05</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    animate:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    regionFit:</code><code class="keyword">true</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    userLocation:</code><code class="keyword">false</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    annotations: annotations</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">mapview.addRoute({</code></div>
<div class="line"><code class="plain">	name: </code><code class="string">&apos;myroute&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	width: </code><code class="value">4</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	color: </code><code class="string">&apos;#f00&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	points: [</code></div>
<div class="line"><code class="plain">		{latitude:</code><code class="value">37.422502</code><code class="plain">, longitude:-</code><code class="value">122.0855498</code><code class="plain">},</code></div>
<div class="line"><code class="plain">		{latitude:</code><code class="value">37.389569</code><code class="plain">, longitude:-</code><code class="value">122.050212</code><code class="plain">},</code></div>
<div class="line"><code class="plain">		{latitude:</code><code class="value">37.331689</code><code class="plain">, longitude:-</code><code class="value">122.030731</code><code class="plain">}</code></div>
<div class="line"><code class="plain">	]</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win.add(mapview);</code></div>
<div class="line"><code class="plain">win.open();</code></div>
</div>
</div> <p>
After we add the route to the existing <tt class=" ">MapView</tt>, we get the following map on iPhone.    </p>
<p>
<img src="images/download/attachments/29004916/route.png" alt="images/download/attachments/29004916/route.png" class="confluence-embedded-image confluence-content-image-border">
</p>
</div>
<div class="section section-3 " id="29004916_NativeMapsandAnnotations-GoogleMapsAPIKeyforAndroid">
<h3 class="heading "><span>Google Maps API Key for Android</span></h3>
<p>
Google requires a different Map API key for each certificate that signs an Android application. While Titanium automatically provides you with this key during development, you&apos;ll need your own when you build for distribution. API Keys can be obtained without a fee from Google. For a more in depth overview, read the <a class="external-link external-link" href="https://developers.google.com/maps/documentation/android/v1/" target="_blank">Google Maps External Library overview</a>.    </p>
<p>
In order to receive an API key that corresponds to your apps&apos; certificate, you&apos;ll need to follow these steps:    </p>
<div class="section section-4 " id="29004916_NativeMapsandAnnotations-1.ObtaintheMD5hashofyourapp&apos;scertificatefromthekeystore">
<h4 class="heading "><span>1. Obtain the MD5 hash of your app&apos;s certificate from the keystore</span></h4>
<p>
Google uses the MD5 fingerprint of the certificate that signs your mobile application to generate a Maps API Key. This API Key is needed by Titanium when constructing the MapView. When your mobile application is run on the emulator or on a device, the underlying Maps implementation verifies that the API key used to pull map data matches the certificate which signed your application.    </p>
<p>
In order to get the MD5 hash of your distribution certificate, we run the Java SDK keystore tool <tt class=" ">keytool</tt> from command line with the following parameters, explained below:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">keytool -list -keystore YOUR_KEYSTORE -alias ALIAS -storepass STOREPASS</code></div>
</div>
</div><ul class=" "><li class=" "> <p>
<tt class=" ">YOUR_KEYSTORE</tt> - The full path to your app&apos;s keystore file. For more details on how a keystore is generated, please reference the <a class="document-link " href="#!/guide/Distributing_Android_apps" distributing_android_apps.html="Distributing_Android_apps.html">Distributing Android apps</a> chapter of this book, as well as the <a class="external-link external-link" href="http://developer.android.com/guide/publishing/app-signing.html" target="_blank">Android app signing documentation</a>.    </p>
</li><li class=" "> <p>
<tt class=" ">ALIAS</tt> - The alias you assigned to your keystore when you created it    </p>
</li><li class=" "> <p>
<tt class=" ">STOREPASS</tt> - The password you assigned to secure your keystore when you created it    </p>
</li></ul> <p>
Upon successful execution of this command you should receive an output similar to the one below. The MD5 hash required is the <tt class=" ">Certificate fingerprint (MD5)</tt> field, which has been highlighted. Copy and/or save the value found in this field.    </p>
<p>
<img src="images/download/attachments/29004916/cert.png" alt="images/download/attachments/29004916/cert.png" class="confluence-embedded-image confluence-content-image-border">
</p>
</div>
<div class="section section-4 " id="29004916_NativeMapsandAnnotations-2.SignupforanAndroidMapsAPIKey">
<h4 class="heading "><span>2. Sign up for an Android Maps API Key</span></h4>
<p>
Once you have the MD5 fingerprint, log in with your Google (Gmail) account and visit the <a class="external-link external-link" href="https://developers.google.com/maps/documentation/android/v1/maps-api-signup" target="_blank">Android Maps API Key Signup</a> form.    </p>
<p>
<img src="images/download/attachments/29004916/maps-api-key-signup.png" alt="images/download/attachments/29004916/maps-api-key-signup.png" class="confluence-embedded-image confluence-content-image-border">
</p>
<p>
Paste in your fingerprint and agree to the terms. Press Generate API Key. You should see a result similar to the image below.    </p>
<p>
<img src="images/download/attachments/29004916/generate-api-key.png" alt="images/download/attachments/29004916/generate-api-key.png" class="confluence-embedded-image confluence-content-image-border">
</p>
</div>
<div class="section section-4 " id="29004916_NativeMapsandAnnotations-3.PutyourAPIKeyintiapp.xmlinthepropertyti.android.google.map.api.key">
<h4 class="heading "><span>3. Put your API Key in tiapp.xml in the property ti.android.google.map.api.key</span></h4>
<p>
Once you have received your API key, you need only include it in your project&apos;s <tt class=" ">tiapp.xml</tt> file to use it. To do so, we add an application property to the existing file under the main <tt class=" ">&lt;ti:app&gt;</tt> element. The property will look like this:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">&lt;property name=</code><code class="string">&quot;ti.android.google.map.api.key&quot;</code><code class="plain">&gt;YOUR_ANDROID_MAPS_API_KEY&lt;/property&gt;</code></div>
</div>
</div> <p>
So if you were to include this in a basic <tt class=" ">tiapp.xml</tt> file, it would look something like this:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">&lt;?xml version=</code><code class="string">&quot;1.0&quot;</code><code class="plain"> encoding=</code><code class="string">&quot;UTF-8&quot;</code><code class="plain">?&gt;</code></div>
<div class="line"><code class="plain">&lt;ti:app xmlns:ti=</code><code class="string">&quot;http://ti.appcelerator.org&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;deployment-targets&gt;</code></div>
<div class="line"><code class="plain">        &lt;target device=</code><code class="string">&quot;mobileweb&quot;</code><code class="plain">&gt;</code><code class="keyword">false</code><code class="plain">&lt;/target&gt;</code></div>
<div class="line"><code class="plain">        &lt;target device=</code><code class="string">&quot;iphone&quot;</code><code class="plain">&gt;</code><code class="keyword">false</code><code class="plain">&lt;/target&gt;</code></div>
<div class="line"><code class="plain">        &lt;target device=</code><code class="string">&quot;ipad&quot;</code><code class="plain">&gt;</code><code class="keyword">false</code><code class="plain">&lt;/target&gt;</code></div>
<div class="line"><code class="plain">        &lt;target device=</code><code class="string">&quot;android&quot;</code><code class="plain">&gt;</code><code class="keyword">true</code><code class="plain">&lt;/target&gt;</code></div>
<div class="line"><code class="plain">        &lt;target device=</code><code class="string">&quot;blackberry&quot;</code><code class="plain">&gt;</code><code class="keyword">false</code><code class="plain">&lt;/target&gt;</code></div>
<div class="line"><code class="plain">    &lt;/deployment-targets&gt;</code></div>
<div class="line"><code class="plain">    &lt;id&gt;com.maps&lt;/id&gt;</code></div>
<div class="line"><code class="plain">    &lt;name&gt;maps&lt;/name&gt;</code></div>
<div class="line"><code class="plain">    &lt;version&gt;</code><code class="value">1.0</code><code class="plain">&lt;/version&gt;</code></div>
<div class="line"><code class="plain">    &lt;publisher&gt;tlukasavage&lt;/publisher&gt;</code></div>
<div class="line"><code class="plain">    &lt;url&gt;http:</code><code class="comments">//appcelerator.com&lt;/url&gt;</code></div>
<div class="line"><code class="plain">    &lt;description&gt;not specified&lt;/description&gt;</code></div>
<div class="line"><code class="plain">    &lt;copyright&gt;</code><code class="value">2011</code><code class="plain"> by tlukasavage&lt;/copyright&gt;</code></div>
<div class="line"><code class="plain">    &lt;icon&gt;appicon.png&lt;/icon&gt;</code></div>
<div class="line"><code class="plain">    &lt;persistent-wifi&gt;</code><code class="keyword">false</code><code class="plain">&lt;/persistent-wifi&gt;</code></div>
<div class="line"><code class="plain">    &lt;prerendered-icon&gt;</code><code class="keyword">false</code><code class="plain">&lt;/prerendered-icon&gt;</code></div>
<div class="line"><code class="plain">    &lt;statusbar-style&gt;</code><code class="keyword">default</code><code class="plain">&lt;/statusbar-style&gt;</code></div>
<div class="line"><code class="plain">    &lt;statusbar-hidden&gt;</code><code class="keyword">false</code><code class="plain">&lt;/statusbar-hidden&gt;</code></div>
<div class="line"><code class="plain">    &lt;fullscreen&gt;</code><code class="keyword">false</code><code class="plain">&lt;/fullscreen&gt;</code></div>
<div class="line"><code class="plain">    &lt;navbar-hidden&gt;</code><code class="keyword">false</code><code class="plain">&lt;/navbar-hidden&gt;</code></div>
<div class="line"><code class="plain">    &lt;analytics&gt;</code><code class="keyword">true</code><code class="plain">&lt;/analytics&gt;</code></div>
<div class="line"><code class="plain">    &lt;guid&gt;YOUR_GUID&lt;/guid&gt;</code></div>
<div class="line"><code class="plain">    &lt;iphone&gt;</code></div>
<div class="line"><code class="plain">        &lt;orientations device=</code><code class="string">&quot;iphone&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">            &lt;orientation&gt;Ti.UI.PORTRAIT&lt;/orientation&gt;</code></div>
<div class="line"><code class="plain">        &lt;/orientations&gt;</code></div>
<div class="line"><code class="plain">        &lt;orientations device=</code><code class="string">&quot;ipad&quot;</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">            &lt;orientation&gt;Ti.UI.PORTRAIT&lt;/orientation&gt;</code></div>
<div class="line"><code class="plain">            &lt;orientation&gt;Ti.UI.UPSIDE_PORTRAIT&lt;/orientation&gt;</code></div>
<div class="line"><code class="plain">            &lt;orientation&gt;Ti.UI.LANDSCAPE_LEFT&lt;/orientation&gt;</code></div>
<div class="line"><code class="plain">            &lt;orientation&gt;Ti.UI.LANDSCAPE_RIGHT&lt;/orientation&gt;</code></div>
<div class="line"><code class="plain">        &lt;/orientations&gt;</code></div>
<div class="line"><code class="plain">    &lt;/iphone&gt;</code></div>
<div class="line"><code class="plain">    &lt;android xmlns:android=</code><code class="string">&quot;http://schemas.android.com/apk/res/android&quot;</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;modules/&gt;</code></div>
<div class="line"><code class="plain">    &lt;!-- Here&apos;s where we add the API key --&gt;</code></div>
<div class="line"><code class="plain">    &lt;property name=</code><code class="string">&quot;ti.android.google.map.api.key&quot;</code><code class="plain">&gt;YOUR_ANDROID_MAPS_API_KEY&lt;/property&gt;</code></div>
<div class="line"><code class="plain">&lt;/ti:app&gt;</code></div>
</div>
</div> <p>
You are now ready to use the Google map views in your distributable Titanium app.    </p>
</div>
</div>
</div>
<div class="section section-2 " id="29004916_NativeMapsandAnnotations-Summary">
<h2 class="heading "><span>Summary</span></h2>
<p>
In this chapter we learned how to use the <tt class=" ">Ti.Map</tt> module to create, display, annotate, and navigate through maps. We used <tt class=" ">Ti.Map.MapView</tt> to represent native maps in our mobile app. In addition we used <tt class=" ">Ti.Map.Annotations</tt> to mark places of interest on our maps, adding more detailed data to our location based interactions. Finally, we learned how we can use <tt class=" ">routes</tt> to connect points of interest to our maps.    </p>
</div>
</div>

</div>

</body>
</html>