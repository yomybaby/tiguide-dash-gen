<!-- single file version -->
<!DOCTYPE html>
<html>
<head>
  <link href="css/github.css" rel="stylesheet" type="text/css">
  <link href="resources/css/common.css" rel="stylesheet" type="text/css">
  <meta charset="utf-8" />
</head>
<body>

<div class="container">
<div class="header"></div>
<div id="29004891" class="content">
<h1>Coding Strategies</h1>
<div class="section section-2 " id="29004891_CodingStrategies-Objective">
<h2 class="heading "><span>Objective</span></h2>
<p>
In this chapter, you will examine techniques for writing large JavaScript applications within the Titanium environment. You&apos;ll look also at some coding strategies that will help you organize your code, reduce repetition, and ease development and maintenance.    </p>
</div>
<div class="section section-2 " id="29004891_CodingStrategies-Contents">
<h2 class="heading "><span>Contents</span></h2>
<p>
For many programmers, their first Titanium app is also their first experience with a large JavaScript project. While most have experience with browser-based JavaScript for adding client side interactivity, few have built entire applications using it. As you grow as a Titanium developer, you will find that a bevy of globally scoped functions and variables will quickly become unmanageable.    </p>
<p>
Let&apos;s take a look at the coding principles and application structures to which you should adhere to create high quality Titanium apps. In addition, we&apos;ll take a brief look at some community-supplied frameworks that are available to improve the structure and scalability of your Titanium projects.    </p>
<div class="section section-3 " id="29004891_CodingStrategies-Codingprinciples">
<h3 class="heading "><span>Coding principles</span></h3>
<p>
When writing JavaScript for your Titanium apps, you should strive to achieve these programming principles:    </p>
<ul class=" "><li class=" "> <p>
Protect the global scope    </p>
</li><li class=" "> <p>
Keep your code DRY (http://en.wikipedia.org/wiki/Don&apos;t_repeat_yourself)    </p>
</li><li class=" "> <p>
Use a single execution context    </p>
</li></ul> <div class="section section-4 " id="29004891_CodingStrategies-Globalscope">
<h4 class="heading "><span>Global scope</span></h4>
<p>
JavaScript has a limited notion of <a class="external-link external-link" href="http://en.wikipedia.org/wiki/Scope_(computer_science)" target="_blank">scope</a>, with variables too often being dumped into one global context. In fact, the only <a class="external-link external-link" href="http://eloquentjavascript.net/chapter3.html#key10" target="_blank">scope</a> besides global that JavaScript supports is functional scope. This means that the scope of your variables and functions can be contained within other functions. For example, here&apos;s a simple case where functional scope is used to keep temporary variables from polluting the global scope. We make use of an immediate function to execute our code:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var sum = (function() {</code></div>
<div class="line"><code class="plain">    var tmpValue = </code><code class="value">0</code><code class="plain">;</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">for</code><code class="plain"> (var i = </code><code class="value">0</code><code class="plain">; i &lt; </code><code class="value">100</code><code class="plain">; i++) {</code></div>
<div class="line"><code class="plain">        tmpValue += i;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> tmpValue;</code></div>
<div class="line"><code class="plain">})();</code></div>
</div>
</div> <p>
Now we have the computed value in our <tt class=" ">sum</tt> variable, and the <tt class=" ">tmpValue</tt> and <tt class=" ">i</tt> variables are no longer part of the scope as they were contained within the functional scope of our immediate function.    </p>
<p>
In addition to its concept of scope, JavaScript is also quite flexible in that it is loosely typed. This means that you can repurpose objects, including variables and functions, at any time in your code via assignment. But as I&apos;m sure you&apos;ve heard before, with great power comes great responsibility. If we are not careful with the management of our code, the power of JavaScript&apos;s expressive code can cause just as many problems as it solves.    </p>
<p>
We touched on protecting the global scope in the <a class="document-link " href="#!/guide/JavaScript_Development_Primer" javascript_development_primer.html="JavaScript_Development_Primer.html">JavaScript Development Primer</a> chapter. As we stated there, a much better approach than global variables/functions is to enclose all your application&apos;s API functions and properties into a single variable (<a class="external-link external-link" href="http://en.wikipedia.org/wiki/Namespace_(computer_science)" target="_blank">namespace</a>). This will minimize the chances of your code colliding with other code or libraries.    </p>
<p>
To refresh your memory on creating namespaces to protect the global scope, here&apos;s the example we gave back in the Primer chapter:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// Define a single namespace to hold all your variables, it&apos;s the only global variable</code></div>
<div class="line"><code class="plain">var myapp = {};</code></div>
<div class="line"><code class="plain">myapp.key = </code><code class="string">&quot;value&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="comments">/* Or, define the namespace and a few variables all at once with</code></div>
<div class="line"><code class="comments">var myapp = {</code></div>
<div class="line"><code class="comments">    key: &apos;value&apos;,</code></div>
<div class="line"><code class="comments">    foo: &apos;bar&apos;,</code></div>
<div class="line"><code class="comments">    charlie: &apos;horse&apos;</code></div>
<div class="line"><code class="comments">};</code></div>
<div class="line"><code class="comments">*/</code></div>
<div class="line"><code class="comments">// add a function to your namespace</code></div>
<div class="line"><code class="plain">myapp.dosomething = function(foo) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// do something</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"><code class="comments">// extend and encapsulate by using self-calling functions</code></div>
<div class="line"><code class="plain">(function() {</code></div>
<div class="line"><code class="plain">    function helper() {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// this is a private function not directly accessible from the global scope</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    myapp.info = function(msg) {</code></div>
<div class="line"><code class="plain"> </code><code class="comments">// added to the app&apos;s namespace, so a public function</code></div>
<div class="line"><code class="plain">        helper(msg);</code></div>
<div class="line"><code class="plain">        Ti.API.info(msg)</code></div>
<div class="line"><code class="plain">    };</code></div>
<div class="line"><code class="plain">})();</code></div>
<div class="line"><code class="comments">// you could then call your function with</code></div>
<div class="line"><code class="plain">myapp.info(</code><code class="string">&apos;Hello World&apos;</code><code class="plain">);</code></div>
</div>
</div> </div>
<div class="section section-4 " id="29004891_CodingStrategies-StayDRY">
<h4 class="heading "><span>Stay DRY</span></h4>
<p>
By DRY (http://en.wikipedia.org/wiki/Don&apos;t_repeat_yourself), we mean &quot;don&apos;t repeat yourself.&quot; The less you repeat code, the easier it is to write, maintain, and fix that code. There are many techniques that will help you keep your code DRY. Among these are creating <a class="external-link external-link" href="http://en.wikipedia.org/wiki/Factory_method_pattern" target="_blank">factory methods</a> for instantiating program components, capitalizing on JavaScript&apos;s <a class="external-link external-link" href="http://javascript.crockford.com/prototypal.html" target="_blank">inheritance</a> model, and creating libraries of <a class="external-link external-link" href="http://vimeopro.com/appcelerator/forging-titanium/video/27447911" target="_blank">reusable modules</a>.    </p>
</div>
<div class="section section-4 " id="29004891_CodingStrategies-Executioncontexts">
<h4 class="heading "><span>Execution contexts</span></h4>
<p>
If you&apos;ve ever created web pages, you know that JavaScript variables on one page have no access to the JavaScript variables on another. You have to take special steps &#x2013; setting and getting POST or GET parameters, using cookies, or some similar measure &#x2013; to get data from one page to another. Each page has its own global variable, which is cut off from that of any other page. We say each page runs in its own &quot;execution context.&quot;    </p>
<p>
By default, a Titanium Mobile application has a single execution context in which it runs. Your application&apos;s app.js file bootstraps your application and serves as the root context. Your application can have multiple execution contexts (but as we&apos;ll show, you generally don&apos;t want it to). New execution contexts are typically created by opening a new window that points to an external URL in its <tt class=" ">url</tt> property:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">Ti.UI.createWindow({</code></div>
<div class="line"><code class="plain">  url:</code><code class="string">&apos;window.js&apos;</code></div>
<div class="line"><code class="plain">}).open();</code></div>
</div>
</div> <p>
When the window is opened, the script window.js is immediately run in a new execution context. If the preceding code were run in app.js, any variables or function declarations made in app.js would be unavailable within window.js. Try it:    </p>
<ol class=" "><li class=" "> <p>
Create a new Titanium Mobile project.    </p>
</li><li class=" "> <p>
In app.js, cut the following text and paste it into a new file named win1.js:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var label1 = Titanium.UI.createLabel({</code></div>
<div class="line"><code class="plain">	color:</code><code class="string">&apos;#999&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	text:</code><code class="string">&apos;I am Window 1&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	font:{fontSize:</code><code class="value">20</code><code class="plain">,fontFamily:</code><code class="string">&apos;Helvetica Neue&apos;</code><code class="plain">},</code></div>
<div class="line"><code class="plain">	textAlign:</code><code class="string">&apos;center&apos;</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">win1.add(label1);</code></div>
</div>
</div></li><li class=" "> <p>
Then, update the code that defines win1, like this:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win1 = Titanium.UI.createWindow({</code></div>
<div class="line"><code class="plain">    title:</code><code class="string">&apos;Tab 1&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    backgroundColor:</code><code class="string">&apos;#fff&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	url:</code><code class="string">&apos;win1.js&apos;</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div></li><li class=" "> <p>
Build your project for the simulator/emulator. You&apos;ll receive an error that <tt class=" ">win1</tt> is undefined in the win1.js file. The <tt class=" ">win1</tt> variable is defined in app.js, which is a separate context. Let&apos;s fix that.    </p>
</li><li class=" "> <p>
In win1.js, add this statement at the top:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win1 = Ti.UI.currentWindow;</code></div>
</div>
</div></li><li class=" "> <p>
Build your project for the simulator/emulator and this time it will run without errors. To pass data into a separate context, you can add custom properties to your window object.    </p>
</li><li class=" "> <p>
In app.js, update the code to read:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var win1 = Titanium.UI.createWindow({</code></div>
<div class="line"><code class="plain">    title:</code><code class="string">&apos;Tab 1&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    backgroundColor:</code><code class="string">&apos;#fff&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	url:</code><code class="string">&apos;win1.js&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	mylabel:</code><code class="string">&apos;Hello from app.js&apos;</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div></li><li class=" "> <p>
Then, in win1.js, update the code to read:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var label1 = Titanium.UI.createLabel({</code></div>
<div class="line"><code class="plain">	color:</code><code class="string">&apos;#999&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">	text:win1.mylabel,</code></div>
<div class="line"><code class="plain">	font:{fontSize:</code><code class="value">20</code><code class="plain">,fontFamily:</code><code class="string">&apos;Helvetica Neue&apos;</code><code class="plain">},</code></div>
<div class="line"><code class="plain">	textAlign:</code><code class="string">&apos;center&apos;</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div></li><li class=" "> <p>
Build your project for the simulator/emulator. The custom window property you set in app.js is available within the win1.js context and is used as the label&apos;s text.    </p>
</li></ol> <p>
It is possible to communicate across execution contexts using application-level events. Using Titanium&apos;s custom event API, arbitrary JavaScript data structures can be sent and received in different execution contexts. Note that the &apos;payload&apos; of your event must be JSON serializable, so business objects will not preserve any instance methods associated with them. The APIs used to fire and receive events are in the Ti.App namespace.    </p>
<p>
Let&apos;s modify the project you just used to demonstrate multiple contexts.    </p>
<ol class=" "><li class=" "> <p>
In win1.js, add this code:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">label1.addEventListener(</code><code class="string">&apos;click&apos;</code><code class="plain">, function() {</code></div>
<div class="line"><code class="plain">	Ti.App.fireEvent(</code><code class="string">&apos;app:labelclicked&apos;</code><code class="plain">, {newlabel:</code><code class="string">&apos;Sent from win1.js&apos;</code><code class="plain">});</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div></li><li class=" "> <p>
Back in app.js, scroll down to find the <tt class=" ">label2</tt> code. This code is in the app.js context, walled off from the win1.js context. We&apos;ll add an event listener here to update the text of <tt class=" ">label2</tt> when label1 is clicked. Add this code after <tt class=" ">label2</tt>:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">Ti.App.addEventListener(</code><code class="string">&apos;app:labelclicked&apos;</code><code class="plain">, function(e) {</code></div>
<div class="line"><code class="plain">	label2.text = e.newlabel;</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
</div></li><li class=" "> <p>
Build your project for the simulator/emulator. Click the label on tab 1. Switch to tab 2 and the label should now read &apos;Sent from win1.js&apos;.    </p>
</li></ol> <div class="section section-5 " id="29004891_CodingStrategies-ShouldIuseasinglecontextormultiplecontexts?">
<h5 class="heading "><span>Should I use a single context or multiple contexts?</span></h5>
<p>
As is often the case in software development, the answer is &quot;that depends&quot;. Most of the time, we recommend you use a single execution context for these reasons:    </p>
<ul class=" "><li class=" "> <p>
You can pass complex objects easily within your app&apos;s single context &#x2014; With events, you can pass JSON-serializable objects, but not objects with methods.    </p>
</li><li class=" "> <p>
You include your libraries/dependencies only once, since there&apos;s only one context &#x2014; With multiple contexts, each file would need to include your libraries/dependencies, increasing memory usage.    </p>
</li><li class=" "> <p>
In most of the projects done by Appcelerator&apos;s own Professional Services team on Titanium Mobile, a single execution context with multiple included external files is used. However, there are instances where having multiple execution contexts is useful. For example, in our Kitchen Sink application, it is advantageous to have a &apos;clean slate&apos; for every API usage example, so we don&apos;t have to worry about polluting the global scope and can keep the examples easy.    </p>
</li></ul> </div>
</div>
</div>
<div class="section section-3 " id="29004891_CodingStrategies-CreatingHighQualityJavaScriptBasedApps">
<h3 class="heading "><span>Creating High Quality JavaScript Based Apps</span></h3>
<p>
Let&apos;s recap: keep your code DRY, don&apos;t pollute the global scope, and strive for a single context app. We offer a couple of techniques you can use to meet these goals:    </p>
<ul class=" "><li class=" "> <p>
Namespaced pattern with self-calling functions    </p>
</li><li class=" "> <p>
CommonJS modules    </p>
</li></ul> <p>
(These aren&apos;t formal <a class="external-link external-link" href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank">design patterns</a>, but important development concepts for JavaScript and Titanium developers.)    </p>
<div class="section section-4 " id="29004891_CodingStrategies-Namespacedpatternwithself-callingfunctions">
<h4 class="heading "><span>Namespaced pattern with self-calling functions</span></h4>
<p>
A technique we teach in our classroom training sessions involves breaking your app into modular pieces, each constructed using <a class="external-link external-link" href="http://2007-2010.lovemikeg.com/2008/08/17/a-week-in-javascript-patterns-self-invocation/" target="_blank">self-calling functions</a> which modify a single app namespace. (If you want to be semantically-correct, these are <a class="external-link external-link" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/" target="_blank">Immediately Invoked Function Expressions</a>, or IIFEs.) This technique lets you divide code into multiple files, each focused on a discrete purpose. As each library is loaded, it modifies the app&apos;s namespace object, which is the only variable added to the global namespace. Let&apos;s demonstrate this with code:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">app.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// create an object literal to be your app&apos;s namespace</code></div>
<div class="line"><code class="plain">var myapp = {};</code></div>
<div class="line"><code class="comments">// include necessary libraries</code></div>
<div class="line"><code class="plain">Ti.include(</code><code class="string">&apos;ui.js&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="comments">// instantiate and open the main UI component of our app</code></div>
<div class="line"><code class="plain">myapp.mainWindow = myapp.ui.createApplicationWindow();</code></div>
<div class="line"><code class="plain">myapp.mainWindow.open();</code></div>
</div>
</div> <p>
The ui.js library file contains the code that constructs your app&apos;s user interface.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">ui.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// create a self-calling function</code></div>
<div class="line"><code class="plain">(function(){</code></div>
<div class="line"><code class="plain">	myapp.ui = {}; </code><code class="comments">// this sub-namespace extends the app&apos;s namespace object</code></div>
<div class="line"><code class="plain">	myapp.ui.createApplicationWindow = function() {</code></div>
<div class="line"><code class="plain">		var win = Ti.UI.createWindow({</code></div>
<div class="line"><code class="plain">			backgroundColor:</code><code class="string">&apos;white&apos;</code></div>
<div class="line"><code class="plain">		});</code></div>
<div class="line"><code class="plain">		var header = Ti.UI.createLabel({</code></div>
<div class="line"><code class="plain">			text: </code><code class="string">&apos;My App Heading&apos;</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			top: </code><code class="value">10</code></div>
<div class="line"><code class="plain">		});</code></div>
<div class="line"><code class="plain">		win.add(header);</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> win;</code></div>
<div class="line"><code class="plain">	};</code></div>
<div class="line"><code class="plain">})();</code></div>
</div>
</div> <p>
You would add other libraries, as necessary, to round out the functionality of your app. For example, you might put all your database code in a <tt class=" ">db.js</tt> file, your network code in a <tt class=" ">network.js</tt>, and so forth. You can include multiple libraries in a single <tt class=" ">include</tt> call, or make a separate call to <tt class=" ">include</tt> for each library. We recommend you keep namespace variable names short: you&apos;ll be typing them a lot. Use function names that describe their purpose and return value. Take <tt class=" ">createApplicationWindow()</tt> as an example. It &quot;creates&quot; a &quot;window&quot; and the middle part describes what type of window it&apos;s creating. The purpose of the function is clear just by reading its name.    </p>
<p>
A good example of an app that uses this namespaced pattern is <a class="external-link external-link" href="https://github.com/appcelerator-titans/tweetanium" target="_blank">Tweetanium Mobile</a>. We encourage you to download that and study the way that app is put together. The &quot;finished&quot; code we supply for our <a class="external-link external-link" href="http://wiki.appcelerator.org/display/td/TCAD+Course+Labs" target="_blank">classroom labs</a> generally follow this namespaced pattern as well.    </p>
<p>
(As presented here, this is not officially an implementation of the formal <a class="external-link external-link" href="http://addyosmani.com/largescalejavascript/#modpattern" target="_blank">modular pattern</a>. But it would not be too difficult to adapt the code presented here to match that design pattern.)    </p>
</div>
<div class="section section-4 " id="29004891_CodingStrategies-CommonJSmodules">
<h4 class="heading "><span>CommonJS modules</span></h4>
<p>
Titanium Mobile is moving toward the adoption of the <a class="external-link external-link" href="http://www.commonjs.org/" target="_blank">CommonJS</a> module specification as the way in which developers should structure their JavaScript code. While CommonJS Modules are a &quot;standard&quot; <a class="external-link external-link" href="http://wiki.commonjs.org/wiki/Modules/1.1" target="_blank">specification</a>, there are differences in implementation across multiple technology stacks. The aim of this specification is to delineate what is and is not supported by the Titanium Mobile implementation of this spec, starting in 1.8 and moving forward.    </p>
<div class="section section-5 " id="29004891_CodingStrategies-Definitions">
<h5 class="heading "><span>Definitions</span></h5>
<ul class=" "><li class=" "> <p>
<strong class=" ">Module</strong> - Any CommonJS-compliant module which will be consumed in a Titanium Mobile application. This can be a JavaScript file included with an application, or a native extension to Titanium which exposes a JavaScript API.    </p>
</li><li class=" "> <p>
<strong class=" ">Resources</strong> - The Resources directory of a Titanium application, where the user&apos;s source code lives before any processing by our build system.    </p>
</li><li class=" "> <p>
<tt class=" ">exports</tt> - a free variable within a module, to which multiple properties may be added to create a public interface    </p>
</li><li class=" "> <p>
<tt class=" ">module.exports</tt> - an object within a module, which may be REPLACED by an object representing the public interface to the module    </p>
</li></ul> <p>
Our specific implementation of the <a class="external-link external-link" href="http://wiki.commonjs.org/wiki/Modules/1.1" target="_blank">CommonJS Module Specification</a> is based on (and the early implementation on Android taken directly from) that of <a class="external-link external-link" href="http://nodejs.org/docs/v0.6.0/api/modules.html" target="_blank">node.js</a>. While we should not consider our implementation a direct clone of node, we should favor node conventions where possible to foster reuse of modules across both environments.    </p>
</div>
<div class="section section-5 " id="29004891_CodingStrategies-Basicusage">
<h5 class="heading "><span>Basic usage</span></h5>
<p>
In order to use a module within Titanium, you must use the <tt class=" ">require()</tt> function, which is built in to the global scope in every JavaScript context.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var myModule = require(</code><code class="string">&apos;/MyModule&apos;</code><code class="plain">); </code><code class="comments">// don&apos;t include the &quot;.js&quot; extension!</code></div>
</div>
</div> <p>
The string passed to <tt class=" ">require()</tt> is the path to and base name of the JavaScript module to load. We recommend that you use absolute paths, where <tt class=" ">/</tt> corresponds to your app&apos;s Resources directory, to make sure Titanium can locate and load your module. The <tt class=" ">require()</tt> function returns a JavaScript object, with properties, functions, and other data assigned to it which form the public interface to the module. If the module we loaded into the application above exposed a function <tt class=" ">sayHello()</tt>, which would print a name and a welcome message to the console, it would be accessed in this way:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var myModule = require(</code><code class="string">&apos;/MyModule&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">myModule.sayHello(</code><code class="string">&apos;Kevin&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="comments">//console output is &quot;Hello Kevin!&quot;</code></div>
</div>
</div> </div>
<div class="section section-5 " id="29004891_CodingStrategies-JavaScriptModuleComposition">
<h5 class="heading "><span>JavaScript Module Composition</span></h5>
<p>
As in the <a class="external-link external-link" href="http://wiki.commonjs.org/wiki/Modules/1.1" target="_blank">CommonJS Module specification</a>, inside the module&apos;s JavaScript file, there will be a special variable called <tt class=" ">exports</tt> to which properties may be added for the public interface of the module. Anything assigned to it will be available in the calling context as a property of the returned object.    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">MyModule.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="comments">// variables defined in this files are private</code></div>
<div class="line"><code class="plain">var defaultMessage = </code><code class="string">&quot;Hello world&quot;</code><code class="plain">;</code></div>
<div class="line"><code class="comments">// we make objects, variables, functions available to the</code></div>
<div class="line"><code class="comments">// calling context by adding them to the exports object</code></div>
<div class="line"><code class="plain">exports.sayHello = function(msg) {</code></div>
<div class="line"><code class="plain">	Ti.API.info(msg);</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"><code class="comments">// we can assign other objects, functions, and variables to</code></div>
<div class="line"><code class="comments">// exports and they will be available to the calling context</code></div>
<div class="line"><code class="plain">exports.helloWorld = function() {</code></div>
<div class="line"><code class="plain">	Ti.API.info(defaultMessage);</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div> <p>
Alternately, if the module author wishes to make the exported value from the module an object of their own design and choosing, there is a non-standard (but common, as with node.js) extension to the Module specification which allows for this. The <tt class=" ">module.exports</tt> object is available within the module file, and may be assigned any value which the developer would like to return from the <tt class=" ">require</tt> function for their module. This is most commonly used for functions which act as object constructors. The following would be a typical use case for this:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">function Person(firstName,lastName) {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">this</code><code class="plain">.firstName = firstName;</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">this</code><code class="plain">.lastName = lastName;</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">Person.prototype.fullName = function() {</code></div>
<div class="line"><code class="plain"> </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">this</code><code class="plain">.firstName+</code><code class="string">&apos; &apos;</code><code class="plain">+</code><code class="keyword">this</code><code class="plain">.lastName;</code></div>
<div class="line"><code class="plain">};</code></div>
<div class="line"><code class="plain">module.exports = Person;</code></div>
</div>
</div> <p>
Usage:    </p>
<div xmlns="http://www.w3.org/1999/xhtml" class="confbox programlisting scroll-unprocessed">
<div class="title">Resources/app.js</div>
<div class="defaultnew syntaxhighlighter">
<div class="line"><code class="plain">var Person = require(</code><code class="string">&apos;Person&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">var fred = </code><code class="keyword">new</code><code class="plain"> Person(</code><code class="string">&apos;Fred&apos;</code><code class="plain">,</code><code class="string">&apos;Flintstone&apos;</code><code class="plain">);</code></div>
<div class="line"><code class="plain">var fredsName = fred.fullName(); </code><code class="comments">// &quot;Fred Flinstone&quot;</code></div>
</div>
</div> <p>
(You should not mix and match usage of <tt class=" ">module.exports</tt> and <tt class=" ">exports.*</tt>.)    </p>
<p>
CommonJS is being rapidly and widely adopted by professional JavaScript programmers. It is implemented in high-profile projects like <a class="external-link external-link" href="http://nodejs.org/" target="_blank">Node.js</a>, NarwhalJS, <a class="external-link external-link" href="http://www.sproutcore.com/" target="_blank">SproutCore</a>, and more. Much of the code currently being written by our team members follows the CommonJS <tt class=" ">require()</tt> module pattern. We encourage you to use this pattern in your Titanium projects.    </p>
<p>
Some additional CommonJS resources we recommend you check out are:    </p>
<ul class=" "><li class=" "> <p>
<a class="document-link " href="#!/guide/CommonJS_Modules_in_Titanium" commonjs_modules_in_titanium.html="CommonJS_Modules_in_Titanium.html">CommonJS Modules in Titanium</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://vimeopro.com/appcelerator/forging-titanium/video/27447911" target="_blank">Forging Titanium Episode 1: CommonJS Modules</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="https://github.com/appcelerator-titans/TodoList" target="_blank">ToDoList Sample App</a> </p>
</li></ul> </div>
</div>
</div>
<div class="section section-3 " id="29004891_CodingStrategies-Model-View-ControllerusingtheAlloyFramework">
<h3 class="heading "><span>Model-View-Controller using the Alloy Framework</span></h3>
<p>
The Alloy framework provides an alternate model for developing Titanium applications. Alloy is a Model-View-Controller (MVC) framework for Titanium that allows you to define UI elements in declarative markup, instead of code. For more information, see:    </p>
<ul class=" "><li class=" "> <p>
<a class="document-link " href="#!/guide/Alloy_Framework" alloy_framework.html="Alloy_Framework.html">Alloy Framework</a> </p>
</li></ul> </div>
</div>
<div class="section section-2 " id="29004891_CodingStrategies-Hands-onPractice">
<h2 class="heading "><span>Hands-on Practice</span></h2>
<div class="section section-3 " id="29004891_CodingStrategies-Goal">
<h3 class="heading "><span>Goal</span></h3>
<p>
In this activity, you will create a project in which you first implement the self-calling function pattern. Then, you&apos;ll refactor the code to implement the CommonJS module pattern.    </p>
</div>
<div class="section section-3 " id="29004891_CodingStrategies-Steps">
<h3 class="heading "><span>Steps</span></h3>
<p>
<strong class=" ">Part A</strong> </p>
<ol class=" "><li class=" "> <p>
In Studio, create a new project. Delete the default content of app.js.    </p>
</li><li class=" "> <p>
Using the module/self-calling technique outlined above, write an app that:    </p>
<ul class=" "><li class=" "> <p>
Defines a single, hierarchical namespace such that only one variable is added to the global namespace    </p>
</li><li class=" "> <p>
Opens a window with a red background.    </p>
</li><li class=" "> <p>
Includes a single label with white text, centered at the top of the window. Use the label text of your choice.    </p>
</li><li class=" "> <p>
Includes a method to update the label&apos;s text. Use <tt class=" ">setTimeout()</tt> to update the label with new text after a few second delay.    </p>
</li><li class=" "> <p>
If you implement this app in multiple files, add the necessary <tt class=" ">Ti.include()</tt> statement to import them all.    </p>
</li></ul></li><li class=" "> <p>
Build and test your app in the simulator/emulator.    </p>
</li></ol> <p>
<strong class=" ">Part B</strong> </p>
<ol class=" "><li class=" "> <p>
Refactor the code to use the CommonJS <tt class=" ">require()</tt> technique. Your app should still only define a single, hierarchical namespace such that only one variable is added to the global namespace.    </p>
</li><li class=" "> <p>
Build and test your app in the simulator/emulator.    </p>
</li></ol> </div>
<div class="section section-3 " id="29004891_CodingStrategies-ReferencesandFurtherReading">
<h3 class="heading "><span>References and Further Reading</span></h3>
<ul class=" "><li class=" "> <p>
Finished code for <a class="external-link external-link" href="http://assets.appcelerator.com.s3.amazonaws.com/app_u/ebook/2.3_codingpatterns_A.zip" target="_blank">Part A</a> and <a class="external-link external-link" href="http://assets.appcelerator.com.s3.amazonaws.com/app_u/ebook/2.3_codingpatterns_B.zip" target="_blank">Part B</a> </p>
</li><li class=" "> <p>
<a class="document-link " href="#!/guide/CommonJS_Modules_in_Titanium" commonjs_modules_in_titanium.html="CommonJS_Modules_in_Titanium.html">CommonJS Modules in Titanium</a> (Titanium Mobile best practices guide)    </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://www.hunlock.com/blogs/Functional_Javascript" target="_blank">Functional JavaScript</a> </p>
</li><li class=" "> <p>
Video: <a class="external-link external-link" href="http://yuilibrary.com/theater/douglas-crockford/crockonjs-3/" target="_blank">Douglas Crockford on JavaScript functions</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://yuiblog.com/blog/2007/06/12/module-pattern/" target="_blank">Module Pattern</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank">Essential JavaScript Design Patterns ebook</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://addyosmani.com/largescalejavascript" target="_blank">Patterns For Large-Scale JavaScript Application Architecture</a> </p>
</li><li class=" "> <p>
<a class="external-link external-link" href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/" target="_blank">Immediately Invoked Function Expressions</a> </p>
</li></ul> </div>
</div>
<div class="section section-2 " id="29004891_CodingStrategies-Summary">
<h2 class="heading "><span>Summary</span></h2>
<p>
In this chapter, you examined techniques for writing large JavaScript applications within the Titanium environment. You also looked at some coding patterns that can help you organize your code, reduce repetition, and ease development and maintenance. Next we&apos;ll look at how we can developer Titanium apps for multiple mobile platforms with a single code base.    </p>
</div>
</div>

</div>

</body>
</html>